(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSekTVRYingSPdcpjSzVazPOJRJr_SxAyQV1lvqvgzvoW6BtnP8aEoVOo1sZSF6tJ27tLXv7JvxCPP9/pub?output=csv&gid=0&single=true";function Re(n){const e=n.trim().replace(/\r\n/g,`
`).split(`
`);if(e.length<2)return[];const o=a=>{const d=[];let m="",p=!1;for(let u=0;u<a.length;u++){const T=a[u];T==='"'?p&&a[u+1]==='"'?(m+='"',u++):p=!p:T===","&&!p?(d.push(m),m=""):m+=T}return d.push(m),d},i=o(e[1]).map(a=>a.trim()),s=[];for(let a=2;a<e.length;a++){const d=e[a];if(!d.trim())continue;const m=o(d),p={};let u=!1;i.forEach((T,f)=>{const r=m[f]||"";p[T]=r,r.trim()!==""&&(u=!0)}),u&&s.push(p)}return s}async function oo(){const n=`${xe}&_=${Date.now()}`;try{const e=await fetch(n);if(e.ok){const o=await e.text();return Re(o)}console.warn(`Initial fetch with timestamp failed with status: ${e.status}. Retrying without timestamp.`)}catch(e){console.warn("Initial fetch with timestamp failed with a network error. Retrying without timestamp.",e)}console.log("Attempting fallback fetch without cache-busting timestamp.");try{const e=await fetch(xe);if(!e.ok)throw new Error(`Fallback fetch failed: ${e.status} ${e.statusText}`);const o=await e.text();return Re(o)}catch(e){return console.error("Error fetching or parsing stall data after fallback:",e),[]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const dt=[{id:"A",num:1,coords:{top:87.8,left:91,width:1.05,height:1.4},border:{top:86.15,left:52.5,bottom:89.2,right:92.05}},{id:"B",num:1,coords:{top:83.1,left:91,width:1.05,height:1.4},border:{top:81.45,left:52.5,bottom:84.5,right:92.05}},{id:"C",num:1,coords:{top:78.4,left:91,width:1.05,height:1.4},border:{top:76.75,left:52.5,bottom:79.8,right:92.05}},{id:"D",num:1,coords:{top:73.5,left:91,width:1.05,height:1.4},border:{top:71.85,left:52.5,bottom:74.9,right:92.05}},{id:"E",num:1,coords:{top:68.5,left:91,width:1.05,height:1.4},border:{top:66.85,left:52.5,bottom:69.9,right:92.05}},{id:"F",num:1,coords:{top:63.9,left:91,width:1.05,height:1.4},border:{top:62.25,left:52.5,bottom:65.3,right:92.05}},{id:"G",num:1,coords:{top:59.1,left:91,width:1.05,height:1.4},border:{top:57.45,left:52.5,bottom:60.5,right:92.05}},{id:"H",num:1,coords:{top:54.3,left:91,width:1.05,height:1.4},border:{top:52.65,left:52.5,bottom:55.7,right:92.05}},{id:"I",num:1,coords:{top:49.5,left:91,width:1.05,height:1.4},border:{top:47.85,left:52.5,bottom:50.9,right:92.05}},{id:"J",num:1,coords:{top:44.5,left:91,width:1.05,height:1.4},border:{top:42.85,left:52.5,bottom:45.9,right:92.05}},{id:"K",num:1,coords:{top:39.6,left:91,width:1.05,height:1.4},border:{top:37.95,left:52.5,bottom:41,right:92.05}},{id:"L",num:1,coords:{top:34.8,left:91,width:1.05,height:1.4},border:{top:33.15,left:52.5,bottom:36.2,right:92.05}},{id:"M",num:1,coords:{top:30.1,left:91,width:1.05,height:1.4},border:{top:28.45,left:52.5,bottom:31.5,right:92.05}},{id:"N",num:1,coords:{top:25.2,left:91,width:1.05,height:1.4},border:{top:23.55,left:52.5,bottom:26.6,right:92.05}},{id:"O",num:1,coords:{top:20.4,left:91,width:1.05,height:1.4},border:{top:18.75,left:52.5,bottom:21.8,right:92.05}},{id:"P",num:1,coords:{top:15.6,left:91,width:1.05,height:1.4},border:{top:13.95,left:52.5,bottom:17,right:92.05}},{id:"Q",num:1,coords:{top:10.8,left:91,width:1.05,height:1.4},border:{top:9.15,left:52.5,bottom:12.2,right:92.05}},{id:"R",num:1,coords:{top:87.8,left:46.3,width:1.05,height:1.4},border:{top:86.15,left:7.8,bottom:89.2,right:47.35}},{id:"S",num:1,coords:{top:83.1,left:46.3,width:1.05,height:1.4},border:{top:81.45,left:7.8,bottom:84.5,right:47.35}},{id:"T",num:1,coords:{top:78.4,left:46.3,width:1.05,height:1.4},border:{top:76.75,left:7.8,bottom:79.8,right:47.35}},{id:"U",num:1,coords:{top:73.5,left:46.3,width:1.05,height:1.4},border:{top:71.85,left:7.8,bottom:74.9,right:47.35}},{id:"V",num:1,coords:{top:68.7,left:46.3,width:1.05,height:1.4},border:{top:67.05,left:7.8,bottom:70.1,right:47.35}},{id:"W",num:1,coords:{top:63.9,left:46.3,width:1.05,height:1.4},border:{top:62.25,left:7.8,bottom:65.3,right:47.35}},{id:"X",num:1,coords:{top:59.1,left:46.3,width:1.05,height:1.4},border:{top:57.45,left:7.8,bottom:60.5,right:47.35}},{id:"Y",num:1,coords:{top:54.3,left:46.3,width:1.05,height:1.4},border:{top:52.65,left:7.8,bottom:55.7,right:47.35}},{id:"Z",num:1,coords:{top:49.5,left:46.3,width:1.05,height:1.4},border:{top:47.85,left:7.8,bottom:50.9,right:47.35}},{id:"鼠",num:1,coords:{top:44.5,left:46.3,width:1.05,height:1.4},border:{top:42.85,left:7.8,bottom:45.9,right:47.35}},{id:"牛",num:1,coords:{top:39.6,left:46.3,width:1.05,height:1.4},border:{top:37.95,left:7.8,bottom:41,right:47.35}},{id:"虎",num:1,coords:{top:34.9,left:46.3,width:1.05,height:1.4},border:{top:33.25,left:7.8,bottom:36.3,right:47.35}},{id:"兔",num:1,coords:{top:30.1,left:46.3,width:1.05,height:1.4},border:{top:28.45,left:7.8,bottom:31.5,right:47.35}},{id:"龍",num:1,coords:{top:25.2,left:46.3,width:1.05,height:1.4},border:{top:23.55,left:7.8,bottom:26.6,right:47.35}},{id:"蛇",num:1,coords:{top:20.4,left:46.3,width:1.05,height:1.4},border:{top:18.75,left:7.8,bottom:21.8,right:47.35}},{id:"馬",num:1,coords:{top:15.6,left:46.3,width:1.05,height:1.4},border:{top:13.95,left:7.8,bottom:17,right:47.35}},{id:"羊",num:1,coords:{top:10.8,left:46.3,width:1.05,height:1.4},border:{top:9.15,left:7.8,bottom:12.2,right:47.35}},{id:"猴",num:1,coords:{top:73.5,left:4.5,width:1.1,height:1.44},border:{top:52.7,left:4.5,bottom:74.9,right:5.55},isGrouped:!0},{id:"雞",num:1,coords:{top:43.7,left:4.5,width:1.1,height:1.44},border:{top:23,left:4.5,bottom:45.6,right:5.55},isGrouped:!0},{id:"狗",num:1,coords:{top:18.2,left:4.5,width:1.1,height:1.44},border:{top:7.5,left:4.5,bottom:19.8,right:5.55},isGrouped:!0},{id:"特",num:1,coords:{top:84.4,left:4.15,width:1.8,height:2.41},border:{top:77.15,left:4.15,bottom:87.2,right:5.75},isGrouped:!0},{id:"商",num:1,coords:{top:89.5,left:4.15,width:1.8,height:2.41},border:{top:87.5,left:4.15,bottom:91.5,right:5.75},isGrouped:!0},{id:"範",num:1,coords:{top:.5,left:91,width:5,height:5},border:{top:.5,left:86,bottom:5.5,right:96}}];/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:$e,setPrototypeOf:Ne,isFrozen:no,getPrototypeOf:io,getOwnPropertyDescriptor:ao}=Object;let{freeze:j,seal:tt,create:ze}=Object,{apply:re,construct:le}=typeof Reflect<"u"&&Reflect;j||(j=function(e){return e});tt||(tt=function(e){return e});re||(re=function(e,o,i){return e.apply(o,i)});le||(le=function(e,o){return new e(...o)});const Yt=K(Array.prototype.forEach),so=K(Array.prototype.lastIndexOf),De=K(Array.prototype.pop),Ct=K(Array.prototype.push),ro=K(Array.prototype.splice),Gt=K(String.prototype.toLowerCase),ee=K(String.prototype.toString),Oe=K(String.prototype.match),xt=K(String.prototype.replace),lo=K(String.prototype.indexOf),co=K(String.prototype.trim),et=K(Object.prototype.hasOwnProperty),q=K(RegExp.prototype.test),Rt=mo(TypeError);function K(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var o=arguments.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=arguments[s];return re(n,e,i)}}function mo(n){return function(){for(var e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];return le(n,o)}}function M(n,e){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Gt;Ne&&Ne(n,null);let i=e.length;for(;i--;){let s=e[i];if(typeof s=="string"){const a=o(s);a!==s&&(no(e)||(e[i]=a),s=a)}n[s]=!0}return n}function fo(n){for(let e=0;e<n.length;e++)et(n,e)||(n[e]=null);return n}function ct(n){const e=ze(null);for(const[o,i]of $e(n))et(n,o)&&(Array.isArray(i)?e[o]=fo(i):i&&typeof i=="object"&&i.constructor===Object?e[o]=ct(i):e[o]=i);return e}function Nt(n,e){for(;n!==null;){const i=ao(n,e);if(i){if(i.get)return K(i.get);if(typeof i.value=="function")return K(i.value)}n=io(n)}function o(){return null}return o}const ke=j(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),oe=j(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ne=j(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),uo=j(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ie=j(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),po=j(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Pe=j(["#text"]),Be=j(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),ae=j(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),He=j(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Wt=j(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ho=tt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),go=tt(/<%[\w\W]*|[\w\W]*%>/gm),Eo=tt(/\$\{[\w\W]*/gm),bo=tt(/^data-[\-\w.\u00B7-\uFFFF]+$/),To=tt(/^aria-[\-\w]+$/),Ye=tt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),wo=tt(/^(?:\w+script|data):/i),yo=tt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),We=tt(/^html$/i),Lo=tt(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ue=Object.freeze({__proto__:null,ARIA_ATTR:To,ATTR_WHITESPACE:yo,CUSTOM_ELEMENT:Lo,DATA_ATTR:bo,DOCTYPE_NAME:We,ERB_EXPR:go,IS_ALLOWED_URI:Ye,IS_SCRIPT_OR_DATA:wo,MUSTACHE_EXPR:ho,TMPLIT_EXPR:Eo});const Dt={element:1,text:3,progressingInstruction:7,comment:8,document:9},Io=function(){return typeof window>"u"?null:window},vo=function(e,o){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let i=null;const s="data-tt-policy-suffix";o&&o.hasAttribute(s)&&(i=o.getAttribute(s));const a="dompurify"+(i?"#"+i:"");try{return e.createPolicy(a,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+a+" could not be created."),null}},Fe=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Ge(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Io();const e=E=>Ge(E);if(e.version="3.2.6",e.removed=[],!n||!n.document||n.document.nodeType!==Dt.document||!n.Element)return e.isSupported=!1,e;let{document:o}=n;const i=o,s=i.currentScript,{DocumentFragment:a,HTMLTemplateElement:d,Node:m,Element:p,NodeFilter:u,NamedNodeMap:T=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:f,DOMParser:r,trustedTypes:l}=n,b=p.prototype,L=Nt(b,"cloneNode"),w=Nt(b,"remove"),y=Nt(b,"nextSibling"),v=Nt(b,"childNodes"),x=Nt(b,"parentNode");if(typeof d=="function"){const E=o.createElement("template");E.content&&E.content.ownerDocument&&(o=E.content.ownerDocument)}let I,P="";const{implementation:$,createNodeIterator:h,createDocumentFragment:N,getElementsByTagName:U}=o,{importNode:A}=i;let _=Fe();e.isSupported=typeof $e=="function"&&typeof x=="function"&&$&&$.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Y,ERB_EXPR:Q,TMPLIT_EXPR:nt,DATA_ATTR:S,ARIA_ATTR:R,IS_SCRIPT_OR_DATA:B,ATTR_WHITESPACE:F,CUSTOM_ELEMENT:z}=Ue;let{IS_ALLOWED_URI:J}=Ue,k=null;const mt=M({},[...ke,...oe,...ne,...ie,...Pe]);let D=null;const ft=M({},[...Be,...ae,...He,...Wt]);let O=Object.seal(ze(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),it=null,ut=null,_t=!0,pt=!0,de=!1,me=!0,gt=!1,Pt=!0,ht=!1,Xt=!1,Vt=!1,Et=!1,Bt=!1,Ht=!1,fe=!0,ue=!1;const qe="user-content-";let qt=!0,At=!1,bt={},Tt=null;const pe=M({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let he=null;const ge=M({},["audio","video","img","source","image","track"]);let jt=null;const Ee=M({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ut="http://www.w3.org/1998/Math/MathML",Ft="http://www.w3.org/2000/svg",st="http://www.w3.org/1999/xhtml";let wt=st,Kt=!1,Zt=null;const je=M({},[Ut,Ft,st],ee);let $t=M({},["mi","mo","mn","ms","mtext"]),zt=M({},["annotation-xml"]);const Ke=M({},["title","style","font","a","script"]);let St=null;const Ze=["application/xhtml+xml","text/html"],Je="text/html";let G=null,yt=null;const Qe=o.createElement("form"),be=function(t){return t instanceof RegExp||t instanceof Function},Jt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(yt&&yt===t)){if((!t||typeof t!="object")&&(t={}),t=ct(t),St=Ze.indexOf(t.PARSER_MEDIA_TYPE)===-1?Je:t.PARSER_MEDIA_TYPE,G=St==="application/xhtml+xml"?ee:Gt,k=et(t,"ALLOWED_TAGS")?M({},t.ALLOWED_TAGS,G):mt,D=et(t,"ALLOWED_ATTR")?M({},t.ALLOWED_ATTR,G):ft,Zt=et(t,"ALLOWED_NAMESPACES")?M({},t.ALLOWED_NAMESPACES,ee):je,jt=et(t,"ADD_URI_SAFE_ATTR")?M(ct(Ee),t.ADD_URI_SAFE_ATTR,G):Ee,he=et(t,"ADD_DATA_URI_TAGS")?M(ct(ge),t.ADD_DATA_URI_TAGS,G):ge,Tt=et(t,"FORBID_CONTENTS")?M({},t.FORBID_CONTENTS,G):pe,it=et(t,"FORBID_TAGS")?M({},t.FORBID_TAGS,G):ct({}),ut=et(t,"FORBID_ATTR")?M({},t.FORBID_ATTR,G):ct({}),bt=et(t,"USE_PROFILES")?t.USE_PROFILES:!1,_t=t.ALLOW_ARIA_ATTR!==!1,pt=t.ALLOW_DATA_ATTR!==!1,de=t.ALLOW_UNKNOWN_PROTOCOLS||!1,me=t.ALLOW_SELF_CLOSE_IN_ATTR!==!1,gt=t.SAFE_FOR_TEMPLATES||!1,Pt=t.SAFE_FOR_XML!==!1,ht=t.WHOLE_DOCUMENT||!1,Et=t.RETURN_DOM||!1,Bt=t.RETURN_DOM_FRAGMENT||!1,Ht=t.RETURN_TRUSTED_TYPE||!1,Vt=t.FORCE_BODY||!1,fe=t.SANITIZE_DOM!==!1,ue=t.SANITIZE_NAMED_PROPS||!1,qt=t.KEEP_CONTENT!==!1,At=t.IN_PLACE||!1,J=t.ALLOWED_URI_REGEXP||Ye,wt=t.NAMESPACE||st,$t=t.MATHML_TEXT_INTEGRATION_POINTS||$t,zt=t.HTML_INTEGRATION_POINTS||zt,O=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&be(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(O.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&be(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(O.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(O.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),gt&&(pt=!1),Bt&&(Et=!0),bt&&(k=M({},Pe),D=[],bt.html===!0&&(M(k,ke),M(D,Be)),bt.svg===!0&&(M(k,oe),M(D,ae),M(D,Wt)),bt.svgFilters===!0&&(M(k,ne),M(D,ae),M(D,Wt)),bt.mathMl===!0&&(M(k,ie),M(D,He),M(D,Wt))),t.ADD_TAGS&&(k===mt&&(k=ct(k)),M(k,t.ADD_TAGS,G)),t.ADD_ATTR&&(D===ft&&(D=ct(D)),M(D,t.ADD_ATTR,G)),t.ADD_URI_SAFE_ATTR&&M(jt,t.ADD_URI_SAFE_ATTR,G),t.FORBID_CONTENTS&&(Tt===pe&&(Tt=ct(Tt)),M(Tt,t.FORBID_CONTENTS,G)),qt&&(k["#text"]=!0),ht&&M(k,["html","head","body"]),k.table&&(M(k,["tbody"]),delete it.tbody),t.TRUSTED_TYPES_POLICY){if(typeof t.TRUSTED_TYPES_POLICY.createHTML!="function")throw Rt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof t.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Rt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');I=t.TRUSTED_TYPES_POLICY,P=I.createHTML("")}else I===void 0&&(I=vo(l,s)),I!==null&&typeof P=="string"&&(P=I.createHTML(""));j&&j(t),yt=t}},Te=M({},[...oe,...ne,...uo]),we=M({},[...ie,...po]),to=function(t){let c=x(t);(!c||!c.tagName)&&(c={namespaceURI:wt,tagName:"template"});const g=Gt(t.tagName),H=Gt(c.tagName);return Zt[t.namespaceURI]?t.namespaceURI===Ft?c.namespaceURI===st?g==="svg":c.namespaceURI===Ut?g==="svg"&&(H==="annotation-xml"||$t[H]):!!Te[g]:t.namespaceURI===Ut?c.namespaceURI===st?g==="math":c.namespaceURI===Ft?g==="math"&&zt[H]:!!we[g]:t.namespaceURI===st?c.namespaceURI===Ft&&!zt[H]||c.namespaceURI===Ut&&!$t[H]?!1:!we[g]&&(Ke[g]||!Te[g]):!!(St==="application/xhtml+xml"&&Zt[t.namespaceURI]):!1},at=function(t){Ct(e.removed,{element:t});try{x(t).removeChild(t)}catch{w(t)}},Lt=function(t,c){try{Ct(e.removed,{attribute:c.getAttributeNode(t),from:c})}catch{Ct(e.removed,{attribute:null,from:c})}if(c.removeAttribute(t),t==="is")if(Et||Bt)try{at(c)}catch{}else try{c.setAttribute(t,"")}catch{}},ye=function(t){let c=null,g=null;if(Vt)t="<remove></remove>"+t;else{const W=Oe(t,/^[\r\n\t ]+/);g=W&&W[0]}St==="application/xhtml+xml"&&wt===st&&(t='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+t+"</body></html>");const H=I?I.createHTML(t):t;if(wt===st)try{c=new r().parseFromString(H,St)}catch{}if(!c||!c.documentElement){c=$.createDocument(wt,"template",null);try{c.documentElement.innerHTML=Kt?P:H}catch{}}const X=c.body||c.documentElement;return t&&g&&X.insertBefore(o.createTextNode(g),X.childNodes[0]||null),wt===st?U.call(c,ht?"html":"body")[0]:ht?c.documentElement:X},Le=function(t){return h.call(t.ownerDocument||t,t,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Qt=function(t){return t instanceof f&&(typeof t.nodeName!="string"||typeof t.textContent!="string"||typeof t.removeChild!="function"||!(t.attributes instanceof T)||typeof t.removeAttribute!="function"||typeof t.setAttribute!="function"||typeof t.namespaceURI!="string"||typeof t.insertBefore!="function"||typeof t.hasChildNodes!="function")},Ie=function(t){return typeof m=="function"&&t instanceof m};function rt(E,t,c){Yt(E,g=>{g.call(e,t,c,yt)})}const ve=function(t){let c=null;if(rt(_.beforeSanitizeElements,t,null),Qt(t))return at(t),!0;const g=G(t.nodeName);if(rt(_.uponSanitizeElement,t,{tagName:g,allowedTags:k}),Pt&&t.hasChildNodes()&&!Ie(t.firstElementChild)&&q(/<[/\w!]/g,t.innerHTML)&&q(/<[/\w!]/g,t.textContent)||t.nodeType===Dt.progressingInstruction||Pt&&t.nodeType===Dt.comment&&q(/<[/\w]/g,t.data))return at(t),!0;if(!k[g]||it[g]){if(!it[g]&&Ae(g)&&(O.tagNameCheck instanceof RegExp&&q(O.tagNameCheck,g)||O.tagNameCheck instanceof Function&&O.tagNameCheck(g)))return!1;if(qt&&!Tt[g]){const H=x(t)||t.parentNode,X=v(t)||t.childNodes;if(X&&H){const W=X.length;for(let Z=W-1;Z>=0;--Z){const lt=L(X[Z],!0);lt.__removalCount=(t.__removalCount||0)+1,H.insertBefore(lt,y(t))}}}return at(t),!0}return t instanceof p&&!to(t)||(g==="noscript"||g==="noembed"||g==="noframes")&&q(/<\/no(script|embed|frames)/i,t.innerHTML)?(at(t),!0):(gt&&t.nodeType===Dt.text&&(c=t.textContent,Yt([Y,Q,nt],H=>{c=xt(c,H," ")}),t.textContent!==c&&(Ct(e.removed,{element:t.cloneNode()}),t.textContent=c)),rt(_.afterSanitizeElements,t,null),!1)},_e=function(t,c,g){if(fe&&(c==="id"||c==="name")&&(g in o||g in Qe))return!1;if(!(pt&&!ut[c]&&q(S,c))){if(!(_t&&q(R,c))){if(!D[c]||ut[c]){if(!(Ae(t)&&(O.tagNameCheck instanceof RegExp&&q(O.tagNameCheck,t)||O.tagNameCheck instanceof Function&&O.tagNameCheck(t))&&(O.attributeNameCheck instanceof RegExp&&q(O.attributeNameCheck,c)||O.attributeNameCheck instanceof Function&&O.attributeNameCheck(c))||c==="is"&&O.allowCustomizedBuiltInElements&&(O.tagNameCheck instanceof RegExp&&q(O.tagNameCheck,g)||O.tagNameCheck instanceof Function&&O.tagNameCheck(g))))return!1}else if(!jt[c]){if(!q(J,xt(g,F,""))){if(!((c==="src"||c==="xlink:href"||c==="href")&&t!=="script"&&lo(g,"data:")===0&&he[t])){if(!(de&&!q(B,xt(g,F,"")))){if(g)return!1}}}}}}return!0},Ae=function(t){return t!=="annotation-xml"&&Oe(t,z)},Se=function(t){rt(_.beforeSanitizeAttributes,t,null);const{attributes:c}=t;if(!c||Qt(t))return;const g={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:D,forceKeepAttr:void 0};let H=c.length;for(;H--;){const X=c[H],{name:W,namespaceURI:Z,value:lt}=X,Mt=G(W),te=lt;let V=W==="value"?te:co(te);if(g.attrName=Mt,g.attrValue=V,g.keepAttr=!0,g.forceKeepAttr=void 0,rt(_.uponSanitizeAttribute,t,g),V=g.attrValue,ue&&(Mt==="id"||Mt==="name")&&(Lt(W,t),V=qe+V),Pt&&q(/((--!?|])>)|<\/(style|title)/i,V)){Lt(W,t);continue}if(g.forceKeepAttr)continue;if(!g.keepAttr){Lt(W,t);continue}if(!me&&q(/\/>/i,V)){Lt(W,t);continue}gt&&Yt([Y,Q,nt],Ce=>{V=xt(V,Ce," ")});const Me=G(t.nodeName);if(!_e(Me,Mt,V)){Lt(W,t);continue}if(I&&typeof l=="object"&&typeof l.getAttributeType=="function"&&!Z)switch(l.getAttributeType(Me,Mt)){case"TrustedHTML":{V=I.createHTML(V);break}case"TrustedScriptURL":{V=I.createScriptURL(V);break}}if(V!==te)try{Z?t.setAttributeNS(Z,W,V):t.setAttribute(W,V),Qt(t)?at(t):De(e.removed)}catch{Lt(W,t)}}rt(_.afterSanitizeAttributes,t,null)},eo=function E(t){let c=null;const g=Le(t);for(rt(_.beforeSanitizeShadowDOM,t,null);c=g.nextNode();)rt(_.uponSanitizeShadowNode,c,null),ve(c),Se(c),c.content instanceof a&&E(c.content);rt(_.afterSanitizeShadowDOM,t,null)};return e.sanitize=function(E){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=null,g=null,H=null,X=null;if(Kt=!E,Kt&&(E="<!-->"),typeof E!="string"&&!Ie(E))if(typeof E.toString=="function"){if(E=E.toString(),typeof E!="string")throw Rt("dirty is not a string, aborting")}else throw Rt("toString is not a function");if(!e.isSupported)return E;if(Xt||Jt(t),e.removed=[],typeof E=="string"&&(At=!1),At){if(E.nodeName){const lt=G(E.nodeName);if(!k[lt]||it[lt])throw Rt("root node is forbidden and cannot be sanitized in-place")}}else if(E instanceof m)c=ye("<!---->"),g=c.ownerDocument.importNode(E,!0),g.nodeType===Dt.element&&g.nodeName==="BODY"||g.nodeName==="HTML"?c=g:c.appendChild(g);else{if(!Et&&!gt&&!ht&&E.indexOf("<")===-1)return I&&Ht?I.createHTML(E):E;if(c=ye(E),!c)return Et?null:Ht?P:""}c&&Vt&&at(c.firstChild);const W=Le(At?E:c);for(;H=W.nextNode();)ve(H),Se(H),H.content instanceof a&&eo(H.content);if(At)return E;if(Et){if(Bt)for(X=N.call(c.ownerDocument);c.firstChild;)X.appendChild(c.firstChild);else X=c;return(D.shadowroot||D.shadowrootmode)&&(X=A.call(i,X,!0)),X}let Z=ht?c.outerHTML:c.innerHTML;return ht&&k["!doctype"]&&c.ownerDocument&&c.ownerDocument.doctype&&c.ownerDocument.doctype.name&&q(We,c.ownerDocument.doctype.name)&&(Z="<!DOCTYPE "+c.ownerDocument.doctype.name+`>
`+Z),gt&&Yt([Y,Q,nt],lt=>{Z=xt(Z,lt," ")}),I&&Ht?I.createHTML(Z):Z},e.setConfig=function(){let E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Jt(E),Xt=!0},e.clearConfig=function(){yt=null,Xt=!1},e.isValidAttribute=function(E,t,c){yt||Jt({});const g=G(E),H=G(t);return _e(g,H,c)},e.addHook=function(E,t){typeof t=="function"&&Ct(_[E],t)},e.removeHook=function(E,t){if(t!==void 0){const c=so(_[E],t);return c===-1?void 0:ro(_[E],c,1)[0]}return De(_[E])},e.removeHooks=function(E){_[E]=[]},e.removeAllHooks=function(){_=Fe()},e}var kt=Ge();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _o=new Map(dt.map(n=>[n.id,n]));function Ao(n,e){return e?e.split(";").map((o,i)=>{const s=`${n}-宣傳車${i+1}`,a=o.trim();return{text:s,href:a}}).filter(o=>o!==null&&!!o.text&&!!o.href):[]}function So(n){const e=document.createElement("div");return e.innerHTML=n,e.querySelectorAll("iframe").forEach(o=>{const i=o.getAttribute("width"),s=o.getAttribute("height");i&&(o.style.width="100%",o.removeAttribute("width")),s&&(o.style.height=`${s}px`,o.removeAttribute("height"))}),e.innerHTML}function Mo(n){return n?n.split(";").map(e=>kt.sanitize((e==null?void 0:e.trim())??"")).filter(e=>e):[]}function Co(n){const e=new Map;return n.forEach(o=>{const i=o.id||o.stallId;if(!i)return;let s=e.get(i);if(!s){const p=i.substring(0,1),u=parseInt(o.num,10),T=parseInt(o.stallCnt,10)||1,f=_o.get(p);if(!f||isNaN(u)){console.warn(`Could not calculate position for stall ID: ${i}. Skipping base creation.`);return}const r=f.coords;let l,b;if(p!=="狗"&&p!=="雞"&&p!=="猴"&&p!=="特"&&p!=="商"){const w=u>36?72-u:u;let y=0,v=r.top,x=r.left;u>24&&u<=48?y=1.75:u<=12||u>=61?y=0:y=.9,u>36?(v=v-r.height-.25,x=r.left-w%72*r.width-y):(x=r.left-(w-1)*r.width-y,T>1&&(x-=(T-1)*r.width));const I=parseFloat(x.toFixed(2)),P=r.width*T;l={top:`${v}%`,left:`${I}%`,width:`${P}%`,height:`${r.height}%`},b={top:v,left:I,width:P,height:r.height}}else{let w=u,y=0;p==="狗"?u>=4&&u<16?(w=3,y=.8):u>=16&&(w=u-12,y=.4):p==="雞"?u>=4&&u<21?(w=3,y=.8):u>=21&&(w=u-17,y=.4):p==="猴"&&(u>=4&&u<23?(w=3,y=.8):u>=23&&(w=u-19,y=.5));let v=r.top-r.height*(w-1)-y;T>1&&(v-=(T-1)*r.height);const x=parseFloat(v.toFixed(2)),I=r.height*T;l={top:`${x}%`,left:`${r.left}%`,width:`${r.width}%`,height:`${I}%`},b={top:x,left:r.left,width:r.width,height:I}}let L=o.stallImg||void 0;L&&L.startsWith("assets/2025/")&&(L=`https://cdn.jsdelivr.net/gh/v4724/nice-0816@d24cd07/${L}`),s={id:i,num:u,stallCnt:T,coords:l,numericCoords:b,stallTitle:o.stallTitle||"N/A",stallImg:L,stallLink:o.stallLink||void 0,promoData:[],promoTags:[]},e.set(i,s)}const a=kt.sanitize(o.promoUser||""),d=kt.sanitize(o.promoAvatar||"");let m=o.promoHTML||"";if(m.includes("iframe")&&m.includes("https://www.facebook.com/plugins")?(m=So(m),m=kt.sanitize(m||"",{ADD_TAGS:["iframe"],FORBID_TAGS:[],ALLOWED_URI_REGEXP:/^https:\/\/(www\.)?facebook\.com\/plugins\//i})):m=kt.sanitize(m||""),a){const p={stallId:i,promoUser:a,promoAvatar:d,promoHTML:m,promoLinks:Ao(a,o.promoLinks),promoTags:Mo(o.promoTags)};s.promoData.push(p)}}),e.forEach(o=>{const i=new Set;o.promoData.forEach(s=>{s.promoTags.forEach(a=>i.add(a))}),o.promoTags=Array.from(i)}),Array.from(e.values())}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ot=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","鼠","牛","虎","兔","龍","蛇","馬","羊","商","特","猴","雞","狗"],xo=(n,e)=>{const o=e.toLowerCase().trim();return o===""?n:n.filter(i=>{const s=i.promoData.some(a=>a.promoUser.toLowerCase().includes(o));return i.id.toLowerCase().includes(o)||i.stallTitle.toLowerCase().includes(o)||s})},It=(n,e,o)=>{const i=n.id.substring(0,1),s=n.num,a=["狗","雞","猴","特","商"].includes(i),d=ot.indexOf(i);if(o==="right"&&i>="A"&&i<="Q"&&(s===1||s===72))return null;if(o==="left"||o==="right"){const m=o==="right"?"prev":"next",p=!a&&!(s>=1&&s<=36),u=m==="next"?1:-1,T=p?-u:u;let f=s+T;for(;f>=1&&f<=72;){const r=e.find(l=>l.id.startsWith(i)&&l.num===f);if(r)return r.id;f+=T}return null}if(o==="up"||o==="down"){if(d===-1)return null;const m=o==="up"?1:-1;let p=d+m;for(;p>=0&&p<ot.length;){const u=ot[p],T=e.filter(f=>f.id.startsWith(u));if(T.length>0){let f;return a?o==="down"?f=T.sort((r,l)=>l.num-r.num)[0]:f=T.sort((r,l)=>r.num-l.num)[0]:(f=T.find(r=>r.num===s),f||(f=T.sort((r,l)=>Math.abs(r.num-s)-Math.abs(l.num-s))[0])),(f==null?void 0:f.id)||null}p+=m}}return null};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ro(n,e,o,i,s,a,d,m,p){const u=p?3.5:2.5,T=new Map,f=new Map;let r=!1,l=!1,b=!1,L=0,w=0,y=0,v=0,x=!1,I=null;const P=()=>{const S=n.offsetWidth,R=n.offsetHeight;if(S===0||R===0)return;const B=(o.offsetLeft+o.offsetWidth/2)/S*100,F=(o.offsetTop+o.offsetHeight/2)/R*100;if(F<9.15||F>89.2){a.current.textContent="",a.prev.textContent="",a.next.textContent="";return}let k=null,mt=1/0;for(const D of dt){const ft=Math.max(D.border.left-B,0,B-D.border.right),O=Math.max(D.border.top-F,0,F-D.border.bottom),it=ft*ft+O*O;it<mt&&(mt=it,k=D)}if(k){const D=ot.indexOf(k.id);a.current.textContent=k.id,a.prev.textContent=D>0?ot[D-1]:"",a.next.textContent=D<ot.length-1?ot[D+1]:""}else a.current.textContent="",a.prev.textContent="",a.next.textContent=""},$=()=>{const S=o.offsetWidth,R=o.offsetHeight,B=o.offsetLeft+S/2,F=o.offsetTop+R/2,z=-(B*u-S/2),J=-(F*u-R/2);i.style.backgroundPosition=`${z}px ${J}px`,s.style.left=`${z}px`,s.style.top=`${J}px`,P()},h=(S,R)=>{const B=o.offsetWidth,F=o.offsetHeight,z=n.offsetWidth,J=n.offsetHeight,k=-B/2,mt=-F/2,D=z-B/2,ft=J-F/2,O=Math.max(k,Math.min(S,D)),it=Math.max(mt,Math.min(R,ft));o.style.left=`${O}px`,o.style.top=`${it}px`;const ut=a.current.parentElement;if(ut){const _t=ut.offsetWidth;let pt=0;O<0?pt=-O:O+_t>z&&(pt=z-(O+_t)),ut.style.transform=`translateX(${pt}px) translateY(-50%)`}$()},N=S=>{var z;S.preventDefault(),r=!0,x=!1,I=S.target;const R=(z=S.touches)==null?void 0:z[0],B=R?R.clientX:S.clientX,F=R?R.clientY:S.clientY;L=B,w=F,y=o.offsetLeft,v=o.offsetTop,document.addEventListener("mousemove",U),document.addEventListener("touchmove",U,{passive:!1}),document.addEventListener("mouseup",A),document.addEventListener("touchend",A)},U=S=>{var k;if(!r)return;const R=(k=S.touches)==null?void 0:k[0],B=R?R.clientX:S.clientX,F=R?R.clientY:S.clientY,z=B-L,J=F-w;!x&&(Math.abs(z)>5||Math.abs(J)>5)&&(x=!0),h(y+z,v+J)},A=()=>{r&&(r=!1,document.removeEventListener("mousemove",U),document.removeEventListener("touchmove",U),document.removeEventListener("mouseup",A),document.removeEventListener("touchend",A),!x&&I&&I.closest(".stall-area")&&m(I),I=null)},_=()=>{if(l=!0,i.style.backgroundSize=`${e.offsetWidth*u}px ${e.offsetHeight*u}px`,i.style.backgroundImage=`url('${e.src}')`,s.style.width=`${e.offsetWidth}px`,s.style.height=`${e.offsetHeight}px`,s.style.transform=`scale(${u})`,o.style.display="block",!b){const S=n.offsetWidth,R=n.offsetHeight,B=o.offsetWidth,F=o.offsetHeight;h((S-B)/2,(R-F)/2),b=!0}d.setAttribute("aria-pressed","true"),d.textContent="隱藏放大鏡",$()},Y=()=>{l=!1,o.style.display="none",d.setAttribute("aria-pressed","false"),d.textContent="顯示放大鏡"},Q=()=>{l?Y():_()};return d.addEventListener("click",Q),o.addEventListener("mousedown",N),o.addEventListener("touchstart",N,{passive:!1}),{addStall:S=>{const R=S.dataset.stallId;if(!R)return;const B=S.cloneNode(!0);s.appendChild(B),T.set(R,S),f.set(R,B)},addGroupArea:S=>{const R=S.cloneNode(!0);s.appendChild(R)},updateStallClass:(S,R,B)=>{const F=T.get(S);F&&F.classList.toggle(R,B);const z=f.get(S);z&&z.classList.toggle(R,B)},show:_,hide:Y,toggle:Q,isShown:()=>l}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const No=["map-container","map-image","magnifier-wrapper","magnifier","magnifier-stall-layer","tooltip","modal","modal-close","modal-overlay","modal-title","modal-body","modal-footer","instructions-text","search-input","toggle-magnifier-btn","modal-magnifier-wrapper","modal-magnifier","modal-magnifier-stall-layer","modal-nav-controls","modal-nav-up","modal-nav-down","modal-nav-left","modal-nav-right","magnifier-row-indicator-container","magnifier-row-indicator-prev","magnifier-row-indicator-current","magnifier-row-indicator-next","modal-magnifier-row-indicator-container","modal-magnifier-row-indicator-prev","modal-magnifier-row-indicator-current","modal-magnifier-row-indicator-next","modal-vertical-stall-list","image-lightbox","image-lightbox-close","image-lightbox-image"];function Do(){const n={mapContainer:document.getElementById("map-container"),mapImage:document.getElementById("map-image"),magnifierWrapper:document.getElementById("magnifier-wrapper"),magnifier:document.getElementById("magnifier"),magnifierStallLayer:document.getElementById("magnifier-stall-layer"),magnifierRowIndicatorContainer:document.getElementById("magnifier-row-indicator-container"),magnifierRowIndicatorPrev:document.getElementById("magnifier-row-indicator-prev"),magnifierRowIndicatorCurrent:document.getElementById("magnifier-row-indicator-current"),magnifierRowIndicatorNext:document.getElementById("magnifier-row-indicator-next"),tooltip:document.getElementById("tooltip"),modal:document.getElementById("modal"),modalClose:document.getElementById("modal-close"),modalOverlay:document.getElementById("modal-overlay"),modalHeader:document.querySelector(".modal-header"),modalTitle:document.getElementById("modal-title"),modalBody:document.getElementById("modal-body"),modalFooter:document.getElementById("modal-footer"),instructionsEl:document.getElementById("instructions-text"),searchInput:document.getElementById("search-input"),toggleMagnifierBtn:document.getElementById("toggle-magnifier-btn"),modalMagnifierWrapper:document.getElementById("modal-magnifier-wrapper"),modalMagnifier:document.getElementById("modal-magnifier"),modalMagnifierStallLayer:document.getElementById("modal-magnifier-stall-layer"),modalMagnifierRowIndicatorContainer:document.getElementById("modal-magnifier-row-indicator-container"),modalMagnifierRowIndicatorPrev:document.getElementById("modal-magnifier-row-indicator-prev"),modalMagnifierRowIndicatorCurrent:document.getElementById("modal-magnifier-row-indicator-current"),modalMagnifierRowIndicatorNext:document.getElementById("modal-magnifier-row-indicator-next"),modalNavControls:document.getElementById("modal-nav-controls"),modalNavUp:document.getElementById("modal-nav-up"),modalNavDown:document.getElementById("modal-nav-down"),modalNavLeft:document.getElementById("modal-nav-left"),modalNavRight:document.getElementById("modal-nav-right"),modalVerticalStallList:document.getElementById("modal-vertical-stall-list"),imageLightbox:document.getElementById("image-lightbox"),imageLightboxClose:document.getElementById("image-lightbox-close"),imageLightboxImage:document.getElementById("image-lightbox-image")};for(const e in n)if(!n[e])throw new Error(`Essential DOM element not found: #${e}. The application cannot start.`);return n}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ot={selectedStallElement:null,stallIdToModalCloneMap:new Map,rowIdToModalGroupCloneMap:new Map};function Oo(n,e,o,i){const s=new Set(dt.filter(a=>a.isGrouped).map(a=>a.id));n.forEach(a=>{if(!a.coords)return;const d=document.createElement("div");d.className="stall-area",a.promoData.length>0&&d.classList.add("has-promo");const m=a.id.substring(0,1);s.has(m)&&d.classList.add("is-grouped-member"),d.dataset.stallId=a.id,d.style.top=a.coords.top,d.style.left=a.coords.left,d.style.width=a.coords.width,d.style.height=a.coords.height,d.setAttribute("aria-label",`Stall: ${a.stallTitle}`),a.num&&(d.textContent=a.num.toString().padStart(2,"0")),e.mapContainer.appendChild(d),o==null||o.addStall(d);const p=d.cloneNode(!0);e.modalMagnifierStallLayer.appendChild(p),i.stallIdToModalCloneMap.set(a.id,p)}),dt.forEach(a=>{const d=document.createElement("div");if(d.className="stall-area stall-group-area",d.dataset.rowId=a.id,d.style.top=`${a.border.top}%`,d.style.left=`${a.border.left}%`,d.style.width=`${a.border.right-a.border.left}%`,d.style.height=`${a.border.bottom-a.border.top}%`,d.setAttribute("aria-label",`Row: ${a.id}`),d.textContent=a.id,a.isGrouped||d.classList.add("mobile-only-group"),e.mapContainer.appendChild(d),a.isGrouped){o==null||o.addGroupArea(d);const m=d.cloneNode(!0);e.modalMagnifierStallLayer.appendChild(m),i.rowIdToModalGroupCloneMap.set(a.id,m)}})}function ce(n,e,o,i,s){const a=n.dataset.stallId;if(!a)return;i?i.updateStallClass(a,e,o):n.classList.toggle(e,o);const d=s.stallIdToModalCloneMap.get(a);d&&d.classList.toggle(e,o)}function Xe(n,e,o){o.selectedStallElement&&ce(o.selectedStallElement,"is-selected",!1,e,o),o.selectedStallElement=null,n.tooltip.classList.add("hidden")}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const C={wasMagnifierVisible:!1,isPanning:!1,panStartX:0,panStartY:0,initialBgX:0,initialBgY:0,panHappened:!1,clickTarget:null,animationFrameId:0,targetBgX:0,targetBgY:0};function ko(n,e,o){n&&(o.imageLightboxImage.src=n,o.imageLightboxImage.alt=e,o.imageLightbox.classList.remove("hidden"))}function Po(n){n.imageLightbox.classList.add("hidden"),n.imageLightboxImage.src=""}function Bo(n,e,o,i){const{elements:s,isMobile:a}=n,{modalMagnifier:d,mapImage:m,modalMagnifierRowIndicatorContainer:p}=s,{modalMagnifierRowIndicatorPrev:u,modalMagnifierRowIndicatorCurrent:T,modalMagnifierRowIndicatorNext:f}=s;p.style.display="flex";let r=null;if(i){const l=i.id.substring(0,1);r=dt.find(b=>b.id===l)??null}else{const l=a?4.5:1.8,b=d.offsetWidth,L=d.offsetHeight,w=m.offsetWidth,y=m.offsetHeight;if(w===0||y===0)return;const v=(b/2-e)/l,x=(L/2-o)/l,I=v/w*100,P=x/y*100;let $=1/0;for(const h of dt){const N=Math.max(h.border.left-I,0,I-h.border.right),U=Math.max(h.border.top-P,0,P-h.border.bottom),A=N*N+U*U;A<$&&($=A,r=h)}}if(r&&r.id==="範")T.textContent="",u.textContent="",f.textContent="";else if(p.style.display="flex",r){const l=ot.indexOf(r.id);T.textContent=r.id,u.textContent=l>0?ot[l-1]:"",f.textContent=l<ot.length-1?ot[l+1]:""}else T.textContent="",u.textContent="",f.textContent=""}function Ve(n,e,o,i){const{elements:s,isMobile:a,allStalls:d,uiState:m}=n,{modalMagnifier:p,modalMagnifierStallLayer:u,mapImage:T}=s,f=a?4.5:1.8,r=p.offsetWidth,l=p.offsetHeight;if(r===0||l===0)return{clampedBgX:0,clampedBgY:0};const b=T.offsetWidth,L=T.offsetHeight;if(b===0||L===0)return{clampedBgX:0,clampedBgY:0};const w=b*f,y=L*f,v=Math.max(r-w,Math.min(e,0)),x=Math.max(l-y,Math.min(o,0));p.style.backgroundPosition=`${v}px ${x}px`,u.style.transform=`translate(${v}px, ${x}px) scale(${f})`;const I=r/f*.5,P=l/f*.5,$=-v/f-I,h=-x/f-P,N=(-v+r)/f+I,U=(-x+l)/f+P;return d.forEach(A=>{const _=m.stallIdToModalCloneMap.get(A.id);if(!_||!A.numericCoords)return;const{left:Y,top:Q,width:nt,height:S}=A.numericCoords,R=Y/100*b,B=Q/100*L,F=R+nt/100*b,z=B+S/100*L,J=R<N&&F>$&&B<U&&z>h;_.classList.toggle("modal-map-hidden",!J)}),dt.forEach(A=>{const _=m.rowIdToModalGroupCloneMap.get(A.id);if(!_)return;const Y=A.border.left/100*b,Q=A.border.top/100*L,nt=A.border.right/100*b,S=A.border.bottom/100*L,R=Y<N&&nt>$&&Q<U&&S>h;_.classList.toggle("modal-map-hidden",!R)}),Bo(n,v,x,i),{clampedBgX:v,clampedBgY:x}}function Ho(n,e){const{elements:o,isMobile:i}=e,{modalMagnifierWrapper:s,modalMagnifier:a,modalMagnifierStallLayer:d,mapImage:m}=o;if(!n||!n.coords){s.style.display="none";return}s.style.display="block",s.style.cursor="grab";const p=i?4.5:1.8,u=a.offsetWidth,T=a.offsetHeight;if(u===0||T===0){s.style.display="none";return}const f=m.offsetWidth,r=m.offsetHeight,l=f*p,b=r*p;d.style.width=`${f}px`,d.style.height=`${r}px`,a.style.backgroundSize=`${l}px ${b}px`,a.style.backgroundImage=`url('${m.src}')`;const{left:L,top:w,width:y,height:v}=n.numericCoords;if([L,w,y,v].some(N=>typeof N!="number")){console.error("Could not parse stall coordinates for modal magnifier:",n.coords),s.style.display="none";return}const x=(L+y/2)/100*f,I=(w+v/2)/100*r,P=u/2-x*p,$=T/2-I*p;Ve(e,P,$,n);let h=d.querySelector(".modal-stall-highlight");h||(h=document.createElement("div"),h.className="modal-stall-highlight",d.appendChild(h)),h.style.width=n.coords.width,h.style.height=n.coords.height,h.style.left=n.coords.left,h.style.top=n.coords.top,h.style.visibility="visible"}function vt(n,e){var v,x,I,P,$;const{allStalls:o,elements:i,magnifierController:s,uiState:a,isMobile:d}=e,m=o.find(h=>h.id===n);if(!m)return;s&&i.modal.classList.contains("hidden")&&(C.wasMagnifierVisible=s.isShown(),C.wasMagnifierVisible&&s.hide());const p=a.selectedStallElement,u=((v=p==null?void 0:p.dataset.stallId)==null?void 0:v.substring(0,1))??null;Xe(i,s,a);const T=document.querySelector(`.stall-area[data-stall-id="${n}"]`);T&&(a.selectedStallElement=T,ce(T,"is-selected",!0,s,a)),i.modalTitle.textContent=`${m.id}: ${m.stallTitle}`;let f=m.stallImg?`<img src="${m.stallImg}" alt="Official Promo Image: ${m.stallTitle}" class="official-stall-image" loading="lazy" onload="this.classList.add('loaded')"/>`:"";m.stallImg&&m.promoData.length>0&&(f+='<hr class="promo-section-separator">'),m.promoData.forEach((h,N)=>{N>0&&(f+='<div class="promo-entry-separator"></div>');const U=h.promoAvatar?h.promoAvatar:"https://images.plurk.com/3rbw6tg1lA5dEGpdKTL8j1.png";let A="";h.promoTags&&h.promoTags.length>0&&(A+='<div class="promo-tags-container">',h.promoTags.forEach(_=>{A+=`<span class="promo-tag">#${_}</span>`}),A+="</div>"),f+=`
      <div class="promo-entry">
          <div class="modal-user-info">
              <img src="${U}" alt="${h.promoUser}" class="modal-avatar">
              <span class="modal-username">${h.promoUser}</span>
          </div>
          ${A}
          <div class="promo-html-content">${h.promoHTML}</div>
      </div>`}),i.modalBody.innerHTML=f||"暫無宣傳資訊。",window.instgrm&&window.instgrm.Embeds.process(),window.twttr&&((I=(x=window.twttr)==null?void 0:x.widgets)==null||I.load(document.getElementsByClassName("modal-wrapper")[0])),i.modalFooter.innerHTML="";const r=h=>{if(h&&h.href){const N=document.createElement("a");N.href=h.href,N.textContent=h.text,N.className="footer-link",N.target="_blank",N.rel="noopener noreferrer",i.modalFooter.appendChild(N)}};m.promoData.forEach(h=>h.promoLinks.forEach(r)),m.stallLink&&r({href:m.stallLink,text:"社團網站"});const l=xo(o,i.searchInput.value),b=m.id.substring(0,1),w=["猴","雞","狗","特","商"].includes(b);if(w){i.modalNavLeft.style.display="none",i.modalNavRight.style.display="none",i.modalNavUp.style.display="block",i.modalNavDown.style.display="block",i.modalNavUp.ariaLabel="往上一個攤位",i.modalNavDown.ariaLabel="往下一個攤位";let h,N=1;for(;m.num+N<=34;){const _=(P=l.find(Y=>Y.id.startsWith(b)&&Y.num===m.num+N))==null?void 0:P.id;if(_){h=_;break}N+=1}let U,A=-1;for(;m.num+A>0;){const _=($=l.find(Y=>Y.id.startsWith(b)&&Y.num===m.num+A))==null?void 0:$.id;if(_){U=_;break}A-=1}h||(h=It(m,l,"up")),U||(U=It(m,l,"down")),i.modalNavUp.disabled=!h,i.modalNavUp.dataset.targetId=h??"",i.modalNavDown.disabled=!U,i.modalNavDown.dataset.targetId=U??"",i.modalNavLeft.disabled=!0,i.modalNavRight.disabled=!0}else{i.modalNavLeft.style.display="block",i.modalNavRight.style.display="block",i.modalNavUp.style.display="block",i.modalNavDown.style.display="block",i.modalNavUp.ariaLabel="往上一排",i.modalNavDown.ariaLabel="往下一排";const h={up:It(m,l,"up"),down:It(m,l,"down"),left:It(m,l,"left"),right:It(m,l,"right")};i.modalNavUp.disabled=!h.up,i.modalNavUp.dataset.targetId=h.up??"",i.modalNavDown.disabled=!h.down,i.modalNavDown.dataset.targetId=h.down??"",i.modalNavLeft.disabled=!h.left,i.modalNavLeft.dataset.targetId=h.left??"",i.modalNavRight.disabled=!h.right,i.modalNavRight.dataset.targetId=h.right??""}const{modalVerticalStallList:y}=i;if(w){b!==u&&(y.scrollTop=0),y.innerHTML="",y.style.display="flex";const h=o.filter(A=>A.id.startsWith(b)).sort((A,_)=>_.num-A.num),N=i.searchInput.value.toLowerCase().trim();h.forEach(A=>{const _=document.createElement("div");_.className="modal-vertical-stall-item",_.dataset.stallId=A.id,_.textContent=A.num.toString().padStart(2,"0"),A.promoData.length>0&&_.classList.add("has-promo");let Y=!1;if(N!==""){const Q=A.promoData.some(S=>S.promoUser.toLowerCase().includes(N)),nt=A.promoTags.some(S=>S.toLowerCase().includes(N));Y=A.id.toLowerCase().includes(N)||A.stallTitle.toLowerCase().includes(N)||Q||nt}Y&&_.classList.add("is-search-match"),A.id===n&&_.classList.add("is-selected"),y.appendChild(_)});const U=y.querySelector(".is-selected");U&&requestAnimationFrame(()=>{U.scrollIntoView({behavior:"smooth",block:"center"})})}else y.innerHTML="",y.style.display="none";document.body.classList.add("body-modal-open"),i.modal.classList.remove("hidden"),i.modalNavControls.style.display="grid",i.modal.setAttribute("aria-hidden","true"),Ho(m,e)}function se(n){const{elements:e,magnifierController:o,uiState:i}=n;document.body.classList.remove("body-modal-open"),e.modal.classList.add("hidden"),e.modalNavControls.style.display="none",e.modal.setAttribute("aria-hidden","true"),Xe(e,o,i),o&&C.wasMagnifierVisible&&o.show(),C.wasMagnifierVisible=!1,e.modalMagnifierWrapper.style.display="none",e.modalVerticalStallList.style.display="none"}function Uo(n,e){var m;const{allStalls:o,uiState:i}=e,s=n.closest(".stall-group-area"),a=n.closest(".stall-area:not(.stall-group-area)"),d=(m=i.selectedStallElement)==null?void 0:m.dataset.stallId;if(s!=null&&s.dataset.rowId){const p=s.dataset.rowId;if(p===(d==null?void 0:d.substring(0,1)))return;const u=o.filter(T=>T.id.startsWith(p)).sort((T,f)=>f.num-T.num);u.length>0&&vt(u[0].id,e)}else if(a!=null&&a.dataset.stallId){const p=a.dataset.stallId;if(p===d)return;vt(p,e)}}function Fo(n){const{elements:e}=n;e.modalNavControls.addEventListener("click",r=>{const l=r.target.closest(".modal-nav-btn");l!=null&&l.dataset.targetId&&vt(l.dataset.targetId,n)}),e.modalVerticalStallList.addEventListener("click",r=>{const l=r.target.closest(".modal-vertical-stall-item");l!=null&&l.dataset.stallId&&vt(l.dataset.stallId,n)});const{modalMagnifierWrapper:o,modalMagnifier:i,modalMagnifierStallLayer:s}=e,a=()=>{C.isPanning&&(Ve(n,C.targetBgX,C.targetBgY),C.animationFrameId=requestAnimationFrame(a))},d=r=>{var v;if(!C.isPanning)return;r.type==="touchmove"&&r.preventDefault();const l=(v=r.touches)==null?void 0:v[0],b=l?l.clientX:r.clientX,L=l?l.clientY:r.clientY,w=b-C.panStartX,y=L-C.panStartY;!C.panHappened&&(Math.abs(w)>5||Math.abs(y)>5)&&(C.panHappened=!0,o.style.cursor="grabbing"),C.panHappened&&(C.targetBgX=C.initialBgX+w,C.targetBgY=C.initialBgY+y)},m=()=>{cancelAnimationFrame(C.animationFrameId),document.removeEventListener("mousemove",d),document.removeEventListener("touchmove",d),document.removeEventListener("mouseup",m),document.removeEventListener("touchend",m),!C.panHappened&&C.clickTarget&&Uo(C.clickTarget,n),C.isPanning=!1,C.clickTarget=null,o.style.cursor="grab",i.style.transition="",s.style.transition=""},p=r=>{var P,$;const l=r.target;if(l.closest("#modal-vertical-stall-list"))return;const b=l.closest(".stall-group-area"),L=(P=n.uiState.selectedStallElement)==null?void 0:P.dataset.stallId;if(b&&L){const h=b.dataset.rowId,N=L.substring(0,1);if(h===N)return}if("button"in r&&r.button!==0)return;C.isPanning=!0,C.panHappened=!1,C.clickTarget=r.target;const w=($=r.touches)==null?void 0:$[0],y=w?w.clientX:r.clientX,v=w?w.clientY:r.clientY;C.panStartX=y,C.panStartY=v;const x=new DOMMatrix(window.getComputedStyle(s).transform);C.initialBgX=x.e,C.initialBgY=x.f,C.targetBgX=C.initialBgX,C.targetBgY=C.initialBgY,i.style.transition="none",s.style.transition="none";const I=s.querySelector(".modal-stall-highlight");I&&(I.style.visibility="hidden"),cancelAnimationFrame(C.animationFrameId),C.animationFrameId=requestAnimationFrame(a),document.addEventListener("mousemove",d),document.addEventListener("touchmove",d,{passive:!1}),document.addEventListener("mouseup",m,{once:!0}),document.addEventListener("touchend",m,{once:!0})};o.addEventListener("mousedown",p),o.addEventListener("touchstart",p,{passive:!1});const u=()=>Po(e);e.modalBody.addEventListener("click",r=>{const l=r.target;if(l instanceof HTMLImageElement){let b="";const L=l.parentElement;l.classList.contains("official-stall-image")?b=l.src:l.closest(".promo-html-content")&&L instanceof HTMLAnchorElement?RegExp(/https?:\/\/.*\.(jpg|jpeg|png|gif|webp)(\?.*)?$/).test((L==null?void 0:L.href)??"")&&(b=l.alt,r.stopPropagation(),r.preventDefault()):b=l.src,ko(b,l.alt,e)}}),e.imageLightboxClose.addEventListener("click",u),e.imageLightbox.addEventListener("click",r=>{(r.target===e.imageLightbox||r.target===e.imageLightbox.querySelector(".lightbox-overlay"))&&u()}),e.modalClose.addEventListener("click",()=>se(n)),e.modalOverlay.addEventListener("click",()=>se(n)),document.addEventListener("keydown",r=>{if(!e.imageLightbox.classList.contains("hidden")){r.key==="Escape"&&u();return}if(!e.modal.classList.contains("hidden"))switch(r.key){case"Escape":se(n);break;case"ArrowUp":e.modalNavUp.click();break;case"ArrowDown":e.modalNavDown.click();break;case"ArrowLeft":e.modalNavLeft.click();break;case"ArrowRight":e.modalNavRight.click();break}});const{modalNavControls:T,tooltip:f}=e;T.addEventListener("mouseover",r=>{const l=r.target.closest(".modal-nav-btn");if(l instanceof HTMLButtonElement&&!l.disabled){const b=l.ariaLabel;if(b){f.innerHTML=b;const L=l.getBoundingClientRect();f.classList.remove("hidden");const w=f.getBoundingClientRect(),y=L.top-w.height-8,v=L.left+L.width/2-w.width/2;f.style.left=`${v}px`,f.style.top=`${y}px`}}else f.classList.add("hidden")}),T.addEventListener("mouseleave",()=>{f.classList.add("hidden")})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function $o(n){const e=()=>No.every(i=>document.getElementById(i)),o=()=>{e()?n():requestAnimationFrame(o)};o()}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function zo(n){dt.forEach(e=>{const o=document.createElement("div");o.className="debug-border",o.style.top=`${e.border.top}%`,o.style.left=`${e.border.left}%`,o.style.width=`${e.border.right-e.border.left}%`,o.style.height=`${e.border.bottom-e.border.top}%`;const i=document.createElement("span");i.textContent=e.id,o.appendChild(i),n.appendChild(o)})}async function Yo(){const n=Do();new URLSearchParams(window.location.search).get("debug")==="true"&&n.mapContainer.classList.add("debug-mode"),n.instructionsEl.textContent="正在載入地圖與攤位資料",n.instructionsEl.classList.add("loading-text");const o=new Promise((i,s)=>{n.mapImage.complete?i():(n.mapImage.onload=()=>i(),n.mapImage.onerror=()=>s(new Error("Map image failed to load.")))});try{const[i]=await Promise.all([oo(),o]);if(n.instructionsEl.classList.remove("loading-text"),i.length===0){n.mapContainer.innerHTML='<p style="color: red; padding: 20px;"><b>無法載入攤位資料：</b><br>請檢查您的 Google Sheet 是否已「發佈至網路」、網址是否正確，或檢查您的網路連線。</p>',n.instructionsEl.textContent="載入失敗";return}const s=Co(i),d=window.matchMedia("(max-width: 768px)").matches,m={allStalls:s,elements:n,magnifierController:null,uiState:Ot,isMobile:d},p=f=>{const r=f.closest(".stall-group-area"),l=f.closest(".stall-area:not(.stall-group-area)");if(r!=null&&r.dataset.rowId){const b=r.dataset.rowId,L=s.filter(w=>w.id.startsWith(b)).sort((w,y)=>y.num-w.num);L.length>0&&vt(L[0].id,m)}else l!=null&&l.dataset.stallId&&vt(l.dataset.stallId,m)},u=Ro(n.mapContainer,n.mapImage,n.magnifierWrapper,n.magnifier,n.magnifierStallLayer,{prev:n.magnifierRowIndicatorPrev,current:n.magnifierRowIndicatorCurrent,next:n.magnifierRowIndicatorNext},n.toggleMagnifierBtn,p,d);m.magnifierController=u,Oo(s,n,u,Ot),zo(n.mapContainer),Fo(m),n.searchInput.addEventListener("input",()=>{const f=n.searchInput.value.toLowerCase().trim(),r=new Set;s.forEach(l=>{const b=document.querySelector(`.stall-area[data-stall-id="${l.id}"]`);if(!b)return;let L=!1;if(f!==""){const w=l.promoData.some(v=>v.promoUser.toLowerCase().includes(f)),y=l.promoTags.some(v=>v.toLowerCase().includes(f));L=l.id.toLowerCase().includes(f)||l.stallTitle.toLowerCase().includes(f)||w||y}ce(b,"is-search-match",L,u,Ot),L&&r.add(l.id.substring(0,1))}),dt.forEach(l=>{document.querySelectorAll(`.stall-group-area[data-row-id="${l.id}"]`).forEach(L=>{const w=r.has(l.id);L.classList.toggle("is-search-match",w)})})});const T=f=>{const r=f.target;r.closest("#magnifier-wrapper")||(f.type==="touchstart"&&f.preventDefault(),p(r))};d?(n.instructionsEl.textContent="點擊按鈕可用放大鏡，或直接點擊攤位查看宣傳。",n.mapContainer.addEventListener("mousedown",T,{passive:!1}),n.mapContainer.addEventListener("touchstart",T,{passive:!1})):(n.instructionsEl.textContent="點擊按鈕顯示/隱藏放大鏡並拖曳。點擊攤位(含放大鏡內)可看宣傳。",document.addEventListener("mousemove",f=>{Ot.selectedStallElement||(n.tooltip.style.left=`${f.clientX+15}px`,n.tooltip.style.top=`${f.clientY+15}px`)}),n.mapContainer.addEventListener("mouseover",f=>{var b;const l=f.target.closest(".stall-area:not(.stall-group-area)");if(l&&!Ot.selectedStallElement){const L=l.dataset.stallId,w=s.find(y=>y.id===L);if(w){const y=(b=w.promoData)==null?void 0:b.map(v=>v.promoUser).filter((v,x,I)=>I.indexOf(v)===x).join(",");n.tooltip.innerHTML=`<strong>${w.stallTitle}</strong><br><small>${w.id}${y?` / ${y}`:""}</small>`,n.tooltip.classList.remove("hidden")}}}),n.mapContainer.addEventListener("mouseout",f=>{f.target.classList.contains("stall-area")&&n.tooltip.classList.add("hidden")}),n.mapContainer.addEventListener("mousedown",T))}catch(i){console.error("Failed to initialize app:",i),n.instructionsEl.classList.remove("loading-text"),n.instructionsEl.textContent="地圖或資料載入失敗，請重新整理頁面。"}}$o(Yo);
