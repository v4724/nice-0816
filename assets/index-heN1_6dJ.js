(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSekTVRYingSPdcpjSzVazPOJRJr_SxAyQV1lvqvgzvoW6BtnP8aEoVOo1sZSF6tJ27tLXv7JvxCPP9/pub?output=csv";function Re(o){const e=o.trim().replace(/\r\n/g,`
`).split(`
`);if(e.length<2)return[];const n=a=>{const d=[];let f="",p=!1;for(let u=0;u<a.length;u++){const T=a[u];T==='"'?p&&a[u+1]==='"'?(f+='"',u++):p=!p:T===","&&!p?(d.push(f),f=""):f+=T}return d.push(f),d},i=n(e[1]).map(a=>a.trim()),r=[];for(let a=2;a<e.length;a++){const d=e[a];if(!d.trim())continue;const f=n(d),p={};let u=!1;i.forEach((T,m)=>{const s=f[m]||"";p[T]=s,s.trim()!==""&&(u=!0)}),u&&r.push(p)}return r}async function oo(){const o=`${xe}&_=${Date.now()}`;try{const e=await fetch(o);if(e.ok){const n=await e.text();return Re(n)}console.warn(`Initial fetch with timestamp failed with status: ${e.status}. Retrying without timestamp.`)}catch(e){console.warn("Initial fetch with timestamp failed with a network error. Retrying without timestamp.",e)}console.log("Attempting fallback fetch without cache-busting timestamp.");try{const e=await fetch(xe);if(!e.ok)throw new Error(`Fallback fetch failed: ${e.status} ${e.statusText}`);const n=await e.text();return Re(n)}catch(e){return console.error("Error fetching or parsing stall data after fallback:",e),[]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ct=[{id:"A",num:1,coords:{top:87.8,left:91,width:1.05,height:1.4},border:{top:86.15,left:52.5,bottom:89.2,right:92.05}},{id:"B",num:1,coords:{top:83.1,left:91,width:1.05,height:1.4},border:{top:81.45,left:52.5,bottom:84.5,right:92.05}},{id:"C",num:1,coords:{top:78.4,left:91,width:1.05,height:1.4},border:{top:76.75,left:52.5,bottom:79.8,right:92.05}},{id:"D",num:1,coords:{top:73.5,left:91,width:1.05,height:1.4},border:{top:71.85,left:52.5,bottom:74.9,right:92.05}},{id:"E",num:1,coords:{top:68.5,left:91,width:1.05,height:1.4},border:{top:66.85,left:52.5,bottom:69.9,right:92.05}},{id:"F",num:1,coords:{top:63.9,left:91,width:1.05,height:1.4},border:{top:62.25,left:52.5,bottom:65.3,right:92.05}},{id:"G",num:1,coords:{top:59.1,left:91,width:1.05,height:1.4},border:{top:57.45,left:52.5,bottom:60.5,right:92.05}},{id:"H",num:1,coords:{top:54.3,left:91,width:1.05,height:1.4},border:{top:52.65,left:52.5,bottom:55.7,right:92.05}},{id:"I",num:1,coords:{top:49.5,left:91,width:1.05,height:1.4},border:{top:47.85,left:52.5,bottom:50.9,right:92.05}},{id:"J",num:1,coords:{top:44.5,left:91,width:1.05,height:1.4},border:{top:42.85,left:52.5,bottom:45.9,right:92.05}},{id:"K",num:1,coords:{top:39.6,left:91,width:1.05,height:1.4},border:{top:37.95,left:52.5,bottom:41,right:92.05}},{id:"L",num:1,coords:{top:34.8,left:91,width:1.05,height:1.4},border:{top:33.15,left:52.5,bottom:36.2,right:92.05}},{id:"M",num:1,coords:{top:30.1,left:91,width:1.05,height:1.4},border:{top:28.45,left:52.5,bottom:31.5,right:92.05}},{id:"N",num:1,coords:{top:25.2,left:91,width:1.05,height:1.4},border:{top:23.55,left:52.5,bottom:26.6,right:92.05}},{id:"O",num:1,coords:{top:20.4,left:91,width:1.05,height:1.4},border:{top:18.75,left:52.5,bottom:21.8,right:92.05}},{id:"P",num:1,coords:{top:15.6,left:91,width:1.05,height:1.4},border:{top:13.95,left:52.5,bottom:17,right:92.05}},{id:"Q",num:1,coords:{top:10.8,left:91,width:1.05,height:1.4},border:{top:9.15,left:52.5,bottom:12.2,right:92.05}},{id:"R",num:1,coords:{top:87.8,left:46.3,width:1.05,height:1.4},border:{top:86.15,left:7.8,bottom:89.2,right:47.35}},{id:"S",num:1,coords:{top:83.1,left:46.3,width:1.05,height:1.4},border:{top:81.45,left:7.8,bottom:84.5,right:47.35}},{id:"T",num:1,coords:{top:78.4,left:46.3,width:1.05,height:1.4},border:{top:76.75,left:7.8,bottom:79.8,right:47.35}},{id:"U",num:1,coords:{top:73.5,left:46.3,width:1.05,height:1.4},border:{top:71.85,left:7.8,bottom:74.9,right:47.35}},{id:"V",num:1,coords:{top:68.7,left:46.3,width:1.05,height:1.4},border:{top:67.05,left:7.8,bottom:70.1,right:47.35}},{id:"W",num:1,coords:{top:63.9,left:46.3,width:1.05,height:1.4},border:{top:62.25,left:7.8,bottom:65.3,right:47.35}},{id:"X",num:1,coords:{top:59.1,left:46.3,width:1.05,height:1.4},border:{top:57.45,left:7.8,bottom:60.5,right:47.35}},{id:"Y",num:1,coords:{top:54.3,left:46.3,width:1.05,height:1.4},border:{top:52.65,left:7.8,bottom:55.7,right:47.35}},{id:"Z",num:1,coords:{top:49.5,left:46.3,width:1.05,height:1.4},border:{top:47.85,left:7.8,bottom:50.9,right:47.35}},{id:"鼠",num:1,coords:{top:44.5,left:46.3,width:1.05,height:1.4},border:{top:42.85,left:7.8,bottom:45.9,right:47.35}},{id:"牛",num:1,coords:{top:39.6,left:46.3,width:1.05,height:1.4},border:{top:37.95,left:7.8,bottom:41,right:47.35}},{id:"虎",num:1,coords:{top:34.9,left:46.3,width:1.05,height:1.4},border:{top:33.25,left:7.8,bottom:36.3,right:47.35}},{id:"兔",num:1,coords:{top:30.1,left:46.3,width:1.05,height:1.4},border:{top:28.45,left:7.8,bottom:31.5,right:47.35}},{id:"龍",num:1,coords:{top:25.2,left:46.3,width:1.05,height:1.4},border:{top:23.55,left:7.8,bottom:26.6,right:47.35}},{id:"蛇",num:1,coords:{top:20.4,left:46.3,width:1.05,height:1.4},border:{top:18.75,left:7.8,bottom:21.8,right:47.35}},{id:"馬",num:1,coords:{top:15.6,left:46.3,width:1.05,height:1.4},border:{top:13.95,left:7.8,bottom:17,right:47.35}},{id:"羊",num:1,coords:{top:10.8,left:46.3,width:1.05,height:1.4},border:{top:9.15,left:7.8,bottom:12.2,right:47.35}},{id:"猴",num:1,coords:{top:73.5,left:4.5,width:1.1,height:1.44},border:{top:52.7,left:4.5,bottom:74.9,right:5.55},isGrouped:!0},{id:"雞",num:1,coords:{top:43.7,left:4.5,width:1.1,height:1.44},border:{top:23,left:4.5,bottom:45.6,right:5.55},isGrouped:!0},{id:"狗",num:1,coords:{top:18.2,left:4.5,width:1.1,height:1.44},border:{top:7.5,left:4.5,bottom:19.8,right:5.55},isGrouped:!0},{id:"特",num:1,coords:{top:84.4,left:4.15,width:1.8,height:2.41},border:{top:77.15,left:4.15,bottom:87.2,right:5.75},isGrouped:!0},{id:"商",num:1,coords:{top:89.5,left:4.15,width:1.8,height:2.41},border:{top:87.5,left:4.15,bottom:91.5,right:5.75},isGrouped:!0},{id:"範",num:1,coords:{top:.5,left:91,width:5,height:5},border:{top:.5,left:86,bottom:5.5,right:96}}];/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:$e,setPrototypeOf:Ne,isFrozen:no,getPrototypeOf:io,getOwnPropertyDescriptor:ao}=Object;let{freeze:q,seal:tt,create:Ye}=Object,{apply:re,construct:le}=typeof Reflect<"u"&&Reflect;q||(q=function(e){return e});tt||(tt=function(e){return e});re||(re=function(e,n,i){return e.apply(n,i)});le||(le=function(e,n){return new e(...n)});const Yt=j(Array.prototype.forEach),so=j(Array.prototype.lastIndexOf),De=j(Array.prototype.pop),Ct=j(Array.prototype.push),ro=j(Array.prototype.splice),Wt=j(String.prototype.toLowerCase),ee=j(String.prototype.toString),Oe=j(String.prototype.match),xt=j(String.prototype.replace),lo=j(String.prototype.indexOf),co=j(String.prototype.trim),et=j(Object.prototype.hasOwnProperty),V=j(RegExp.prototype.test),Rt=mo(TypeError);function j(o){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return re(o,e,i)}}function mo(o){return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return le(o,n)}}function _(o,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Wt;Ne&&Ne(o,null);let i=e.length;for(;i--;){let r=e[i];if(typeof r=="string"){const a=n(r);a!==r&&(no(e)||(e[i]=a),r=a)}o[r]=!0}return o}function fo(o){for(let e=0;e<o.length;e++)et(o,e)||(o[e]=null);return o}function lt(o){const e=Ye(null);for(const[n,i]of $e(o))et(o,n)&&(Array.isArray(i)?e[n]=fo(i):i&&typeof i=="object"&&i.constructor===Object?e[n]=lt(i):e[n]=i);return e}function Nt(o,e){for(;o!==null;){const i=ao(o,e);if(i){if(i.get)return j(i.get);if(typeof i.value=="function")return j(i.value)}o=io(o)}function n(){return null}return n}const Pe=q(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),oe=q(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ne=q(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),uo=q(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ie=q(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),po=q(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),ke=q(["#text"]),Be=q(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),ae=q(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),He=q(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),zt=q(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ho=tt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),go=tt(/<%[\w\W]*|[\w\W]*%>/gm),Eo=tt(/\$\{[\w\W]*/gm),bo=tt(/^data-[\-\w.\u00B7-\uFFFF]+$/),To=tt(/^aria-[\-\w]+$/),ze=tt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),yo=tt(/^(?:\w+script|data):/i),wo=tt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),We=tt(/^html$/i),Lo=tt(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ue=Object.freeze({__proto__:null,ARIA_ATTR:To,ATTR_WHITESPACE:wo,CUSTOM_ELEMENT:Lo,DATA_ATTR:bo,DOCTYPE_NAME:We,ERB_EXPR:go,IS_ALLOWED_URI:ze,IS_SCRIPT_OR_DATA:yo,MUSTACHE_EXPR:ho,TMPLIT_EXPR:Eo});const Dt={element:1,text:3,progressingInstruction:7,comment:8,document:9},Io=function(){return typeof window>"u"?null:window},vo=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let i=null;const r="data-tt-policy-suffix";n&&n.hasAttribute(r)&&(i=n.getAttribute(r));const a="dompurify"+(i?"#"+i:"");try{return e.createPolicy(a,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+a+" could not be created."),null}},Fe=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Ge(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Io();const e=E=>Ge(E);if(e.version="3.2.6",e.removed=[],!o||!o.document||o.document.nodeType!==Dt.document||!o.Element)return e.isSupported=!1,e;let{document:n}=o;const i=n,r=i.currentScript,{DocumentFragment:a,HTMLTemplateElement:d,Node:f,Element:p,NodeFilter:u,NamedNodeMap:T=o.NamedNodeMap||o.MozNamedAttrMap,HTMLFormElement:m,DOMParser:s,trustedTypes:l}=o,b=p.prototype,L=Nt(b,"cloneNode"),y=Nt(b,"remove"),w=Nt(b,"nextSibling"),v=Nt(b,"childNodes"),S=Nt(b,"parentNode");if(typeof d=="function"){const E=n.createElement("template");E.content&&E.content.ownerDocument&&(n=E.content.ownerDocument)}let I,g="";const{implementation:M,createNodeIterator:C,createDocumentFragment:x,getElementsByTagName:D}=n,{importNode:k}=i;let H=Fe();e.isSupported=typeof $e=="function"&&typeof S=="function"&&M&&M.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Q,ERB_EXPR:K,TMPLIT_EXPR:dt,DATA_ATTR:R,ARIA_ATTR:N,IS_SCRIPT_OR_DATA:U,ATTR_WHITESPACE:$,CUSTOM_ELEMENT:Y}=Ue;let{IS_ALLOWED_URI:J}=Ue,B=null;const mt=_({},[...Pe,...oe,...ne,...ie,...ke]);let O=null;const ft=_({},[...Be,...ae,...He,...zt]);let P=Object.seal(Ye(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),nt=null,ut=null,_t=!0,pt=!0,de=!1,me=!0,gt=!1,Pt=!0,ht=!1,Xt=!1,Vt=!1,Et=!1,kt=!1,Bt=!1,fe=!0,ue=!1;const qe="user-content-";let qt=!0,At=!1,bt={},Tt=null;const pe=_({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let he=null;const ge=_({},["audio","video","img","source","image","track"]);let jt=null;const Ee=_({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ht="http://www.w3.org/1998/Math/MathML",Ut="http://www.w3.org/2000/svg",at="http://www.w3.org/1999/xhtml";let yt=at,Kt=!1,Zt=null;const je=_({},[Ht,Ut,at],ee);let Ft=_({},["mi","mo","mn","ms","mtext"]),$t=_({},["annotation-xml"]);const Ke=_({},["title","style","font","a","script"]);let St=null;const Ze=["application/xhtml+xml","text/html"],Je="text/html";let W=null,wt=null;const Qe=n.createElement("form"),be=function(t){return t instanceof RegExp||t instanceof Function},Jt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(wt&&wt===t)){if((!t||typeof t!="object")&&(t={}),t=lt(t),St=Ze.indexOf(t.PARSER_MEDIA_TYPE)===-1?Je:t.PARSER_MEDIA_TYPE,W=St==="application/xhtml+xml"?ee:Wt,B=et(t,"ALLOWED_TAGS")?_({},t.ALLOWED_TAGS,W):mt,O=et(t,"ALLOWED_ATTR")?_({},t.ALLOWED_ATTR,W):ft,Zt=et(t,"ALLOWED_NAMESPACES")?_({},t.ALLOWED_NAMESPACES,ee):je,jt=et(t,"ADD_URI_SAFE_ATTR")?_(lt(Ee),t.ADD_URI_SAFE_ATTR,W):Ee,he=et(t,"ADD_DATA_URI_TAGS")?_(lt(ge),t.ADD_DATA_URI_TAGS,W):ge,Tt=et(t,"FORBID_CONTENTS")?_({},t.FORBID_CONTENTS,W):pe,nt=et(t,"FORBID_TAGS")?_({},t.FORBID_TAGS,W):lt({}),ut=et(t,"FORBID_ATTR")?_({},t.FORBID_ATTR,W):lt({}),bt=et(t,"USE_PROFILES")?t.USE_PROFILES:!1,_t=t.ALLOW_ARIA_ATTR!==!1,pt=t.ALLOW_DATA_ATTR!==!1,de=t.ALLOW_UNKNOWN_PROTOCOLS||!1,me=t.ALLOW_SELF_CLOSE_IN_ATTR!==!1,gt=t.SAFE_FOR_TEMPLATES||!1,Pt=t.SAFE_FOR_XML!==!1,ht=t.WHOLE_DOCUMENT||!1,Et=t.RETURN_DOM||!1,kt=t.RETURN_DOM_FRAGMENT||!1,Bt=t.RETURN_TRUSTED_TYPE||!1,Vt=t.FORCE_BODY||!1,fe=t.SANITIZE_DOM!==!1,ue=t.SANITIZE_NAMED_PROPS||!1,qt=t.KEEP_CONTENT!==!1,At=t.IN_PLACE||!1,J=t.ALLOWED_URI_REGEXP||ze,yt=t.NAMESPACE||at,Ft=t.MATHML_TEXT_INTEGRATION_POINTS||Ft,$t=t.HTML_INTEGRATION_POINTS||$t,P=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&be(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(P.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&be(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(P.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(P.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),gt&&(pt=!1),kt&&(Et=!0),bt&&(B=_({},ke),O=[],bt.html===!0&&(_(B,Pe),_(O,Be)),bt.svg===!0&&(_(B,oe),_(O,ae),_(O,zt)),bt.svgFilters===!0&&(_(B,ne),_(O,ae),_(O,zt)),bt.mathMl===!0&&(_(B,ie),_(O,He),_(O,zt))),t.ADD_TAGS&&(B===mt&&(B=lt(B)),_(B,t.ADD_TAGS,W)),t.ADD_ATTR&&(O===ft&&(O=lt(O)),_(O,t.ADD_ATTR,W)),t.ADD_URI_SAFE_ATTR&&_(jt,t.ADD_URI_SAFE_ATTR,W),t.FORBID_CONTENTS&&(Tt===pe&&(Tt=lt(Tt)),_(Tt,t.FORBID_CONTENTS,W)),qt&&(B["#text"]=!0),ht&&_(B,["html","head","body"]),B.table&&(_(B,["tbody"]),delete nt.tbody),t.TRUSTED_TYPES_POLICY){if(typeof t.TRUSTED_TYPES_POLICY.createHTML!="function")throw Rt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof t.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Rt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');I=t.TRUSTED_TYPES_POLICY,g=I.createHTML("")}else I===void 0&&(I=vo(l,r)),I!==null&&typeof g=="string"&&(g=I.createHTML(""));q&&q(t),wt=t}},Te=_({},[...oe,...ne,...uo]),ye=_({},[...ie,...po]),to=function(t){let c=S(t);(!c||!c.tagName)&&(c={namespaceURI:yt,tagName:"template"});const h=Wt(t.tagName),F=Wt(c.tagName);return Zt[t.namespaceURI]?t.namespaceURI===Ut?c.namespaceURI===at?h==="svg":c.namespaceURI===Ht?h==="svg"&&(F==="annotation-xml"||Ft[F]):!!Te[h]:t.namespaceURI===Ht?c.namespaceURI===at?h==="math":c.namespaceURI===Ut?h==="math"&&$t[F]:!!ye[h]:t.namespaceURI===at?c.namespaceURI===Ut&&!$t[F]||c.namespaceURI===Ht&&!Ft[F]?!1:!ye[h]&&(Ke[h]||!Te[h]):!!(St==="application/xhtml+xml"&&Zt[t.namespaceURI]):!1},it=function(t){Ct(e.removed,{element:t});try{S(t).removeChild(t)}catch{y(t)}},Lt=function(t,c){try{Ct(e.removed,{attribute:c.getAttributeNode(t),from:c})}catch{Ct(e.removed,{attribute:null,from:c})}if(c.removeAttribute(t),t==="is")if(Et||kt)try{it(c)}catch{}else try{c.setAttribute(t,"")}catch{}},we=function(t){let c=null,h=null;if(Vt)t="<remove></remove>"+t;else{const z=Oe(t,/^[\r\n\t ]+/);h=z&&z[0]}St==="application/xhtml+xml"&&yt===at&&(t='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+t+"</body></html>");const F=I?I.createHTML(t):t;if(yt===at)try{c=new s().parseFromString(F,St)}catch{}if(!c||!c.documentElement){c=M.createDocument(yt,"template",null);try{c.documentElement.innerHTML=Kt?g:F}catch{}}const G=c.body||c.documentElement;return t&&h&&G.insertBefore(n.createTextNode(h),G.childNodes[0]||null),yt===at?D.call(c,ht?"html":"body")[0]:ht?c.documentElement:G},Le=function(t){return C.call(t.ownerDocument||t,t,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Qt=function(t){return t instanceof m&&(typeof t.nodeName!="string"||typeof t.textContent!="string"||typeof t.removeChild!="function"||!(t.attributes instanceof T)||typeof t.removeAttribute!="function"||typeof t.setAttribute!="function"||typeof t.namespaceURI!="string"||typeof t.insertBefore!="function"||typeof t.hasChildNodes!="function")},Ie=function(t){return typeof f=="function"&&t instanceof f};function st(E,t,c){Yt(E,h=>{h.call(e,t,c,wt)})}const ve=function(t){let c=null;if(st(H.beforeSanitizeElements,t,null),Qt(t))return it(t),!0;const h=W(t.nodeName);if(st(H.uponSanitizeElement,t,{tagName:h,allowedTags:B}),Pt&&t.hasChildNodes()&&!Ie(t.firstElementChild)&&V(/<[/\w!]/g,t.innerHTML)&&V(/<[/\w!]/g,t.textContent)||t.nodeType===Dt.progressingInstruction||Pt&&t.nodeType===Dt.comment&&V(/<[/\w]/g,t.data))return it(t),!0;if(!B[h]||nt[h]){if(!nt[h]&&Ae(h)&&(P.tagNameCheck instanceof RegExp&&V(P.tagNameCheck,h)||P.tagNameCheck instanceof Function&&P.tagNameCheck(h)))return!1;if(qt&&!Tt[h]){const F=S(t)||t.parentNode,G=v(t)||t.childNodes;if(G&&F){const z=G.length;for(let Z=z-1;Z>=0;--Z){const rt=L(G[Z],!0);rt.__removalCount=(t.__removalCount||0)+1,F.insertBefore(rt,w(t))}}}return it(t),!0}return t instanceof p&&!to(t)||(h==="noscript"||h==="noembed"||h==="noframes")&&V(/<\/no(script|embed|frames)/i,t.innerHTML)?(it(t),!0):(gt&&t.nodeType===Dt.text&&(c=t.textContent,Yt([Q,K,dt],F=>{c=xt(c,F," ")}),t.textContent!==c&&(Ct(e.removed,{element:t.cloneNode()}),t.textContent=c)),st(H.afterSanitizeElements,t,null),!1)},_e=function(t,c,h){if(fe&&(c==="id"||c==="name")&&(h in n||h in Qe))return!1;if(!(pt&&!ut[c]&&V(R,c))){if(!(_t&&V(N,c))){if(!O[c]||ut[c]){if(!(Ae(t)&&(P.tagNameCheck instanceof RegExp&&V(P.tagNameCheck,t)||P.tagNameCheck instanceof Function&&P.tagNameCheck(t))&&(P.attributeNameCheck instanceof RegExp&&V(P.attributeNameCheck,c)||P.attributeNameCheck instanceof Function&&P.attributeNameCheck(c))||c==="is"&&P.allowCustomizedBuiltInElements&&(P.tagNameCheck instanceof RegExp&&V(P.tagNameCheck,h)||P.tagNameCheck instanceof Function&&P.tagNameCheck(h))))return!1}else if(!jt[c]){if(!V(J,xt(h,$,""))){if(!((c==="src"||c==="xlink:href"||c==="href")&&t!=="script"&&lo(h,"data:")===0&&he[t])){if(!(de&&!V(U,xt(h,$,"")))){if(h)return!1}}}}}}return!0},Ae=function(t){return t!=="annotation-xml"&&Oe(t,Y)},Se=function(t){st(H.beforeSanitizeAttributes,t,null);const{attributes:c}=t;if(!c||Qt(t))return;const h={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:O,forceKeepAttr:void 0};let F=c.length;for(;F--;){const G=c[F],{name:z,namespaceURI:Z,value:rt}=G,Mt=W(z),te=rt;let X=z==="value"?te:co(te);if(h.attrName=Mt,h.attrValue=X,h.keepAttr=!0,h.forceKeepAttr=void 0,st(H.uponSanitizeAttribute,t,h),X=h.attrValue,ue&&(Mt==="id"||Mt==="name")&&(Lt(z,t),X=qe+X),Pt&&V(/((--!?|])>)|<\/(style|title)/i,X)){Lt(z,t);continue}if(h.forceKeepAttr)continue;if(!h.keepAttr){Lt(z,t);continue}if(!me&&V(/\/>/i,X)){Lt(z,t);continue}gt&&Yt([Q,K,dt],Ce=>{X=xt(X,Ce," ")});const Me=W(t.nodeName);if(!_e(Me,Mt,X)){Lt(z,t);continue}if(I&&typeof l=="object"&&typeof l.getAttributeType=="function"&&!Z)switch(l.getAttributeType(Me,Mt)){case"TrustedHTML":{X=I.createHTML(X);break}case"TrustedScriptURL":{X=I.createScriptURL(X);break}}if(X!==te)try{Z?t.setAttributeNS(Z,z,X):t.setAttribute(z,X),Qt(t)?it(t):De(e.removed)}catch{Lt(z,t)}}st(H.afterSanitizeAttributes,t,null)},eo=function E(t){let c=null;const h=Le(t);for(st(H.beforeSanitizeShadowDOM,t,null);c=h.nextNode();)st(H.uponSanitizeShadowNode,c,null),ve(c),Se(c),c.content instanceof a&&E(c.content);st(H.afterSanitizeShadowDOM,t,null)};return e.sanitize=function(E){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=null,h=null,F=null,G=null;if(Kt=!E,Kt&&(E="<!-->"),typeof E!="string"&&!Ie(E))if(typeof E.toString=="function"){if(E=E.toString(),typeof E!="string")throw Rt("dirty is not a string, aborting")}else throw Rt("toString is not a function");if(!e.isSupported)return E;if(Xt||Jt(t),e.removed=[],typeof E=="string"&&(At=!1),At){if(E.nodeName){const rt=W(E.nodeName);if(!B[rt]||nt[rt])throw Rt("root node is forbidden and cannot be sanitized in-place")}}else if(E instanceof f)c=we("<!---->"),h=c.ownerDocument.importNode(E,!0),h.nodeType===Dt.element&&h.nodeName==="BODY"||h.nodeName==="HTML"?c=h:c.appendChild(h);else{if(!Et&&!gt&&!ht&&E.indexOf("<")===-1)return I&&Bt?I.createHTML(E):E;if(c=we(E),!c)return Et?null:Bt?g:""}c&&Vt&&it(c.firstChild);const z=Le(At?E:c);for(;F=z.nextNode();)ve(F),Se(F),F.content instanceof a&&eo(F.content);if(At)return E;if(Et){if(kt)for(G=x.call(c.ownerDocument);c.firstChild;)G.appendChild(c.firstChild);else G=c;return(O.shadowroot||O.shadowrootmode)&&(G=k.call(i,G,!0)),G}let Z=ht?c.outerHTML:c.innerHTML;return ht&&B["!doctype"]&&c.ownerDocument&&c.ownerDocument.doctype&&c.ownerDocument.doctype.name&&V(We,c.ownerDocument.doctype.name)&&(Z="<!DOCTYPE "+c.ownerDocument.doctype.name+`>
`+Z),gt&&Yt([Q,K,dt],rt=>{Z=xt(Z,rt," ")}),I&&Bt?I.createHTML(Z):Z},e.setConfig=function(){let E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Jt(E),Xt=!0},e.clearConfig=function(){wt=null,Xt=!1},e.isValidAttribute=function(E,t,c){wt||Jt({});const h=W(E),F=W(t);return _e(h,F,c)},e.addHook=function(E,t){typeof t=="function"&&Ct(H[E],t)},e.removeHook=function(E,t){if(t!==void 0){const c=so(H[E],t);return c===-1?void 0:ro(H[E],c,1)[0]}return De(H[E])},e.removeHooks=function(E){H[E]=[]},e.removeAllHooks=function(){H=Fe()},e}var Gt=Ge();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _o=new Map(ct.map(o=>[o.id,o]));function Ao(o,e){return e?e.split(";").map((n,i)=>{const r=`${o}-宣傳車${i+1}`,a=n.trim();return{text:r,href:a}}).filter(n=>n!==null&&!!n.text&&!!n.href):[]}function So(o){return o?o.split(";").map(e=>Gt.sanitize((e==null?void 0:e.trim())??"")).filter(e=>e):[]}function Mo(o){const e=new Map;return o.forEach(n=>{const i=n.id||n.stallId;if(!i)return;let r=e.get(i);if(!r){const p=i.substring(0,1),u=parseInt(n.num,10),T=parseInt(n.stallCnt,10)||1,m=_o.get(p);if(!m||isNaN(u)){console.warn(`Could not calculate position for stall ID: ${i}. Skipping base creation.`);return}const s=m.coords;let l,b;if(p!=="狗"&&p!=="雞"&&p!=="猴"&&p!=="特"&&p!=="商"){const y=u>36?72-u:u;let w=0,v=s.top,S=s.left;u>24&&u<=48?w=1.75:u<=12||u>=61?w=0:w=.9,u>36?(v=v-s.height-.25,S=s.left-y%72*s.width-w):(S=s.left-(y-1)*s.width-w,T>1&&(S-=(T-1)*s.width));const I=parseFloat(S.toFixed(2)),g=s.width*T;l={top:`${v}%`,left:`${I}%`,width:`${g}%`,height:`${s.height}%`},b={top:v,left:I,width:g,height:s.height}}else{let y=u,w=0;p==="狗"?u>=4&&u<16?(y=3,w=.8):u>=16&&(y=u-12,w=.4):p==="雞"?u>=4&&u<21?(y=3,w=.8):u>=21&&(y=u-17,w=.4):p==="猴"&&(u>=4&&u<23?(y=3,w=.8):u>=23&&(y=u-19,w=.5));let v=s.top-s.height*(y-1)-w;T>1&&(v-=(T-1)*s.height);const S=parseFloat(v.toFixed(2)),I=s.height*T;l={top:`${S}%`,left:`${s.left}%`,width:`${s.width}%`,height:`${I}%`},b={top:S,left:s.left,width:s.width,height:I}}let L=n.stallImg||void 0;L&&L.startsWith("assets/2025/")&&(L=`https://cdn.jsdelivr.net/gh/v4724/nice-0816@d24cd07/${L}`),r={id:i,num:u,stallCnt:T,coords:l,numericCoords:b,stallTitle:n.stallTitle||"N/A",stallImg:L,stallLink:n.stallLink||void 0,promoData:[],promoTags:[]},e.set(i,r)}const a=Gt.sanitize(n.promoUser||""),d=Gt.sanitize(n.promoAvatar||""),f=Gt.sanitize(n.promoHTML||"");if(a){const p={stallId:i,promoUser:a,promoAvatar:d,promoHTML:f,promoLinks:Ao(a,n.promoLinks),promoTags:So(n.promoTags)};r.promoData.push(p)}}),e.forEach(n=>{const i=new Set;n.promoData.forEach(r=>{r.promoTags.forEach(a=>i.add(a))}),n.promoTags=Array.from(i)}),Array.from(e.values())}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ot=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","鼠","牛","虎","兔","龍","蛇","馬","羊","商","特","猴","雞","狗"],Co=(o,e)=>{const n=e.toLowerCase().trim();return n===""?o:o.filter(i=>{const r=i.promoData.some(a=>a.promoUser.toLowerCase().includes(n));return i.id.toLowerCase().includes(n)||i.stallTitle.toLowerCase().includes(n)||r})},It=(o,e,n)=>{const i=o.id.substring(0,1),r=o.num,a=["狗","雞","猴","特","商"].includes(i),d=ot.indexOf(i);if(n==="right"&&i>="A"&&i<="Q"&&(r===1||r===72))return null;if(n==="left"||n==="right"){const f=n==="right"?"prev":"next",p=!a&&!(r>=1&&r<=36),u=f==="next"?1:-1,T=p?-u:u;let m=r+T;for(;m>=1&&m<=72;){const s=e.find(l=>l.id.startsWith(i)&&l.num===m);if(s)return s.id;m+=T}return null}if(n==="up"||n==="down"){if(d===-1)return null;const f=n==="up"?1:-1;let p=d+f;for(;p>=0&&p<ot.length;){const u=ot[p],T=e.filter(m=>m.id.startsWith(u));if(T.length>0){let m;return a?n==="down"?m=T.sort((s,l)=>l.num-s.num)[0]:m=T.sort((s,l)=>s.num-l.num)[0]:(m=T.find(s=>s.num===r),m||(m=T.sort((s,l)=>Math.abs(s.num-r)-Math.abs(l.num-r))[0])),(m==null?void 0:m.id)||null}p+=f}}return null};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function xo(o,e,n,i,r,a,d,f,p){const u=p?3.5:2.5,T=new Map,m=new Map;let s=!1,l=!1,b=!1,L=0,y=0,w=0,v=0,S=!1,I=null;const g=()=>{const R=o.offsetWidth,N=o.offsetHeight;if(R===0||N===0)return;const U=(n.offsetLeft+n.offsetWidth/2)/R*100,$=(n.offsetTop+n.offsetHeight/2)/N*100;if($<9.15||$>89.2){a.current.textContent="",a.prev.textContent="",a.next.textContent="";return}let B=null,mt=1/0;for(const O of ct){const ft=Math.max(O.border.left-U,0,U-O.border.right),P=Math.max(O.border.top-$,0,$-O.border.bottom),nt=ft*ft+P*P;nt<mt&&(mt=nt,B=O)}if(B){const O=ot.indexOf(B.id);a.current.textContent=B.id,a.prev.textContent=O>0?ot[O-1]:"",a.next.textContent=O<ot.length-1?ot[O+1]:""}else a.current.textContent="",a.prev.textContent="",a.next.textContent=""},M=()=>{const R=n.offsetWidth,N=n.offsetHeight,U=n.offsetLeft+R/2,$=n.offsetTop+N/2,Y=-(U*u-R/2),J=-($*u-N/2);i.style.backgroundPosition=`${Y}px ${J}px`,r.style.left=`${Y}px`,r.style.top=`${J}px`,g()},C=(R,N)=>{const U=n.offsetWidth,$=n.offsetHeight,Y=o.offsetWidth,J=o.offsetHeight,B=-U/2,mt=-$/2,O=Y-U/2,ft=J-$/2,P=Math.max(B,Math.min(R,O)),nt=Math.max(mt,Math.min(N,ft));n.style.left=`${P}px`,n.style.top=`${nt}px`;const ut=a.current.parentElement;if(ut){const _t=ut.offsetWidth;let pt=0;P<0?pt=-P:P+_t>Y&&(pt=Y-(P+_t)),ut.style.transform=`translateX(${pt}px) translateY(-50%)`}M()},x=R=>{var Y;R.preventDefault(),s=!0,S=!1,I=R.target;const N=(Y=R.touches)==null?void 0:Y[0],U=N?N.clientX:R.clientX,$=N?N.clientY:R.clientY;L=U,y=$,w=n.offsetLeft,v=n.offsetTop,document.addEventListener("mousemove",D),document.addEventListener("touchmove",D,{passive:!1}),document.addEventListener("mouseup",k),document.addEventListener("touchend",k)},D=R=>{var B;if(!s)return;const N=(B=R.touches)==null?void 0:B[0],U=N?N.clientX:R.clientX,$=N?N.clientY:R.clientY,Y=U-L,J=$-y;!S&&(Math.abs(Y)>5||Math.abs(J)>5)&&(S=!0),C(w+Y,v+J)},k=()=>{s&&(s=!1,document.removeEventListener("mousemove",D),document.removeEventListener("touchmove",D),document.removeEventListener("mouseup",k),document.removeEventListener("touchend",k),!S&&I&&I.closest(".stall-area")&&f(I),I=null)},H=()=>{if(l=!0,i.style.backgroundSize=`${e.offsetWidth*u}px ${e.offsetHeight*u}px`,i.style.backgroundImage=`url('${e.src}')`,r.style.width=`${e.offsetWidth}px`,r.style.height=`${e.offsetHeight}px`,r.style.transform=`scale(${u})`,n.style.display="block",!b){const R=o.offsetWidth,N=o.offsetHeight,U=n.offsetWidth,$=n.offsetHeight;C((R-U)/2,(N-$)/2),b=!0}d.setAttribute("aria-pressed","true"),d.textContent="隱藏放大鏡",M()},Q=()=>{l=!1,n.style.display="none",d.setAttribute("aria-pressed","false"),d.textContent="顯示放大鏡"},K=()=>{l?Q():H()};return d.addEventListener("click",K),n.addEventListener("mousedown",x),n.addEventListener("touchstart",x,{passive:!1}),{addStall:R=>{const N=R.dataset.stallId;if(!N)return;const U=R.cloneNode(!0);r.appendChild(U),T.set(N,R),m.set(N,U)},addGroupArea:R=>{const N=R.cloneNode(!0);r.appendChild(N)},updateStallClass:(R,N,U)=>{const $=T.get(R);$&&$.classList.toggle(N,U);const Y=m.get(R);Y&&Y.classList.toggle(N,U)},show:H,hide:Q,toggle:K,isShown:()=>l}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ro=["map-container","map-image","magnifier-wrapper","magnifier","magnifier-stall-layer","tooltip","modal","modal-close","modal-overlay","modal-title","modal-body","modal-footer","instructions-text","search-input","toggle-magnifier-btn","modal-magnifier-wrapper","modal-magnifier","modal-magnifier-stall-layer","modal-nav-controls","modal-nav-up","modal-nav-down","modal-nav-left","modal-nav-right","magnifier-row-indicator-container","magnifier-row-indicator-prev","magnifier-row-indicator-current","magnifier-row-indicator-next","modal-magnifier-row-indicator-container","modal-magnifier-row-indicator-prev","modal-magnifier-row-indicator-current","modal-magnifier-row-indicator-next","modal-vertical-stall-list","image-lightbox","image-lightbox-close","image-lightbox-image"];function No(){const o={mapContainer:document.getElementById("map-container"),mapImage:document.getElementById("map-image"),magnifierWrapper:document.getElementById("magnifier-wrapper"),magnifier:document.getElementById("magnifier"),magnifierStallLayer:document.getElementById("magnifier-stall-layer"),magnifierRowIndicatorContainer:document.getElementById("magnifier-row-indicator-container"),magnifierRowIndicatorPrev:document.getElementById("magnifier-row-indicator-prev"),magnifierRowIndicatorCurrent:document.getElementById("magnifier-row-indicator-current"),magnifierRowIndicatorNext:document.getElementById("magnifier-row-indicator-next"),tooltip:document.getElementById("tooltip"),modal:document.getElementById("modal"),modalClose:document.getElementById("modal-close"),modalOverlay:document.getElementById("modal-overlay"),modalHeader:document.querySelector(".modal-header"),modalTitle:document.getElementById("modal-title"),modalBody:document.getElementById("modal-body"),modalFooter:document.getElementById("modal-footer"),instructionsEl:document.getElementById("instructions-text"),searchInput:document.getElementById("search-input"),toggleMagnifierBtn:document.getElementById("toggle-magnifier-btn"),modalMagnifierWrapper:document.getElementById("modal-magnifier-wrapper"),modalMagnifier:document.getElementById("modal-magnifier"),modalMagnifierStallLayer:document.getElementById("modal-magnifier-stall-layer"),modalMagnifierRowIndicatorContainer:document.getElementById("modal-magnifier-row-indicator-container"),modalMagnifierRowIndicatorPrev:document.getElementById("modal-magnifier-row-indicator-prev"),modalMagnifierRowIndicatorCurrent:document.getElementById("modal-magnifier-row-indicator-current"),modalMagnifierRowIndicatorNext:document.getElementById("modal-magnifier-row-indicator-next"),modalNavControls:document.getElementById("modal-nav-controls"),modalNavUp:document.getElementById("modal-nav-up"),modalNavDown:document.getElementById("modal-nav-down"),modalNavLeft:document.getElementById("modal-nav-left"),modalNavRight:document.getElementById("modal-nav-right"),modalVerticalStallList:document.getElementById("modal-vertical-stall-list"),imageLightbox:document.getElementById("image-lightbox"),imageLightboxClose:document.getElementById("image-lightbox-close"),imageLightboxImage:document.getElementById("image-lightbox-image")};for(const e in o)if(!o[e])throw new Error(`Essential DOM element not found: #${e}. The application cannot start.`);return o}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ot={selectedStallElement:null,stallIdToModalCloneMap:new Map,rowIdToModalGroupCloneMap:new Map};function Do(o,e,n,i){const r=new Set(ct.filter(a=>a.isGrouped).map(a=>a.id));o.forEach(a=>{if(!a.coords)return;const d=document.createElement("div");d.className="stall-area",a.promoData.length>0&&d.classList.add("has-promo");const f=a.id.substring(0,1);r.has(f)&&d.classList.add("is-grouped-member"),d.dataset.stallId=a.id,d.style.top=a.coords.top,d.style.left=a.coords.left,d.style.width=a.coords.width,d.style.height=a.coords.height,d.setAttribute("aria-label",`Stall: ${a.stallTitle}`),a.num&&(d.textContent=a.num.toString().padStart(2,"0")),e.mapContainer.appendChild(d),n==null||n.addStall(d);const p=d.cloneNode(!0);e.modalMagnifierStallLayer.appendChild(p),i.stallIdToModalCloneMap.set(a.id,p)}),ct.forEach(a=>{const d=document.createElement("div");if(d.className="stall-area stall-group-area",d.dataset.rowId=a.id,d.style.top=`${a.border.top}%`,d.style.left=`${a.border.left}%`,d.style.width=`${a.border.right-a.border.left}%`,d.style.height=`${a.border.bottom-a.border.top}%`,d.setAttribute("aria-label",`Row: ${a.id}`),d.textContent=a.id,a.isGrouped||d.classList.add("mobile-only-group"),e.mapContainer.appendChild(d),a.isGrouped){n==null||n.addGroupArea(d);const f=d.cloneNode(!0);e.modalMagnifierStallLayer.appendChild(f),i.rowIdToModalGroupCloneMap.set(a.id,f)}})}function ce(o,e,n,i,r){const a=o.dataset.stallId;if(!a)return;i?i.updateStallClass(a,e,n):o.classList.toggle(e,n);const d=r.stallIdToModalCloneMap.get(a);d&&d.classList.toggle(e,n)}function Xe(o,e,n){n.selectedStallElement&&ce(n.selectedStallElement,"is-selected",!1,e,n),n.selectedStallElement=null,o.tooltip.classList.add("hidden")}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const A={wasMagnifierVisible:!1,isPanning:!1,panStartX:0,panStartY:0,initialBgX:0,initialBgY:0,panHappened:!1,clickTarget:null,animationFrameId:0,targetBgX:0,targetBgY:0};function Oo(o,e,n){o&&(n.imageLightboxImage.src=o,n.imageLightboxImage.alt=e,n.imageLightbox.classList.remove("hidden"))}function Po(o){o.imageLightbox.classList.add("hidden"),o.imageLightboxImage.src=""}function ko(o,e,n,i){const{elements:r,isMobile:a}=o,{modalMagnifier:d,mapImage:f,modalMagnifierRowIndicatorContainer:p}=r,{modalMagnifierRowIndicatorPrev:u,modalMagnifierRowIndicatorCurrent:T,modalMagnifierRowIndicatorNext:m}=r;p.style.display="flex";let s=null;if(i){const l=i.id.substring(0,1);s=ct.find(b=>b.id===l)??null}else{const l=a?4.5:1.8,b=d.offsetWidth,L=d.offsetHeight,y=f.offsetWidth,w=f.offsetHeight;if(y===0||w===0)return;const v=(b/2-e)/l,S=(L/2-n)/l,I=v/y*100,g=S/w*100;let M=1/0;for(const C of ct){const x=Math.max(C.border.left-I,0,I-C.border.right),D=Math.max(C.border.top-g,0,g-C.border.bottom),k=x*x+D*D;k<M&&(M=k,s=C)}}if(s&&s.id==="範")T.textContent="",u.textContent="",m.textContent="";else if(p.style.display="flex",s){const l=ot.indexOf(s.id);T.textContent=s.id,u.textContent=l>0?ot[l-1]:"",m.textContent=l<ot.length-1?ot[l+1]:""}else T.textContent="",u.textContent="",m.textContent=""}function Ve(o,e,n,i){const{elements:r,isMobile:a,allStalls:d,uiState:f}=o,{modalMagnifier:p,modalMagnifierStallLayer:u,mapImage:T}=r,m=a?4.5:1.8,s=p.offsetWidth,l=p.offsetHeight;if(s===0||l===0)return{clampedBgX:0,clampedBgY:0};const b=T.offsetWidth,L=T.offsetHeight;if(b===0||L===0)return{clampedBgX:0,clampedBgY:0};const y=b*m,w=L*m,v=Math.max(s-y,Math.min(e,0)),S=Math.max(l-w,Math.min(n,0));p.style.backgroundPosition=`${v}px ${S}px`,u.style.transform=`translate(${v}px, ${S}px) scale(${m})`;const I=s/m*.5,g=l/m*.5,M=-v/m-I,C=-S/m-g,x=(-v+s)/m+I,D=(-S+l)/m+g;return d.forEach(k=>{const H=f.stallIdToModalCloneMap.get(k.id);if(!H||!k.numericCoords)return;const{left:Q,top:K,width:dt,height:R}=k.numericCoords,N=Q/100*b,U=K/100*L,$=N+dt/100*b,Y=U+R/100*L,J=N<x&&$>M&&U<D&&Y>C;H.classList.toggle("modal-map-hidden",!J)}),ct.forEach(k=>{const H=f.rowIdToModalGroupCloneMap.get(k.id);if(!H)return;const Q=k.border.left/100*b,K=k.border.top/100*L,dt=k.border.right/100*b,R=k.border.bottom/100*L,N=Q<x&&dt>M&&K<D&&R>C;H.classList.toggle("modal-map-hidden",!N)}),ko(o,v,S,i),{clampedBgX:v,clampedBgY:S}}function Bo(o,e){const{elements:n,isMobile:i}=e,{modalMagnifierWrapper:r,modalMagnifier:a,modalMagnifierStallLayer:d,mapImage:f}=n;if(!o||!o.coords){r.style.display="none";return}r.style.display="block",r.style.cursor="grab";const p=i?4.5:1.8,u=a.offsetWidth,T=a.offsetHeight;if(u===0||T===0){r.style.display="none";return}const m=f.offsetWidth,s=f.offsetHeight,l=m*p,b=s*p;d.style.width=`${m}px`,d.style.height=`${s}px`,a.style.backgroundSize=`${l}px ${b}px`,a.style.backgroundImage=`url('${f.src}')`;const{left:L,top:y,width:w,height:v}=o.numericCoords;if([L,y,w,v].some(x=>typeof x!="number")){console.error("Could not parse stall coordinates for modal magnifier:",o.coords),r.style.display="none";return}const S=(L+w/2)/100*m,I=(y+v/2)/100*s,g=u/2-S*p,M=T/2-I*p;Ve(e,g,M,o);let C=d.querySelector(".modal-stall-highlight");C||(C=document.createElement("div"),C.className="modal-stall-highlight",d.appendChild(C)),C.style.width=o.coords.width,C.style.height=o.coords.height,C.style.left=o.coords.left,C.style.top=o.coords.top,C.style.visibility="visible"}function vt(o,e){var v,S,I;const{allStalls:n,elements:i,magnifierController:r,uiState:a,isMobile:d}=e,f=n.find(g=>g.id===o);if(!f)return;r&&i.modal.classList.contains("hidden")&&(A.wasMagnifierVisible=r.isShown(),A.wasMagnifierVisible&&r.hide());const p=a.selectedStallElement,u=((v=p==null?void 0:p.dataset.stallId)==null?void 0:v.substring(0,1))??null;Xe(i,r,a);const T=document.querySelector(`.stall-area[data-stall-id="${o}"]`);T&&(a.selectedStallElement=T,ce(T,"is-selected",!0,r,a)),i.modalTitle.textContent=`${f.id}: ${f.stallTitle}`;let m=f.stallImg?`<img src="${f.stallImg}" alt="Official Promo Image: ${f.stallTitle}" class="official-stall-image" loading="lazy"/>`:"";f.stallImg&&f.promoData.length>0&&(m+='<hr class="promo-section-separator">'),f.promoData.forEach((g,M)=>{M>0&&(m+='<div class="promo-entry-separator"></div>');const C=g.promoAvatar?g.promoAvatar:"https://images.plurk.com/3rbw6tg1lA5dEGpdKTL8j1.png";let x="";g.promoTags&&g.promoTags.length>0&&(x+='<div class="promo-tags-container">',g.promoTags.forEach(D=>{x+=`<span class="promo-tag">#${D}</span>`}),x+="</div>"),m+=`
      <div class="promo-entry">
          <div class="modal-user-info">
              <img src="${C}" alt="${g.promoUser}" class="modal-avatar">
              <span class="modal-username">${g.promoUser}</span>
          </div>
          ${x}
          <div class="promo-html-content">${g.promoHTML}</div>
      </div>`}),i.modalBody.innerHTML=m||"暫無宣傳資訊。",i.modalFooter.innerHTML="";const s=g=>{if(g&&g.href){const M=document.createElement("a");M.href=g.href,M.textContent=g.text,M.className="footer-link",M.target="_blank",M.rel="noopener noreferrer",i.modalFooter.appendChild(M)}};f.promoData.forEach(g=>g.promoLinks.forEach(s)),f.stallLink&&s({href:f.stallLink,text:"社團網站"});const l=Co(n,i.searchInput.value),b=f.id.substring(0,1),y=["猴","雞","狗","特","商"].includes(b);if(y){i.modalNavLeft.style.display="none",i.modalNavRight.style.display="none",i.modalNavUp.style.display="block",i.modalNavDown.style.display="block",i.modalNavUp.ariaLabel="往上一個攤位",i.modalNavDown.ariaLabel="往下一個攤位";let g,M=1;for(;f.num+M<=34;){const D=(S=l.find(k=>k.id.startsWith(b)&&k.num===f.num+M))==null?void 0:S.id;if(D){g=D;break}M+=1}let C,x=-1;for(;f.num+x>0;){const D=(I=l.find(k=>k.id.startsWith(b)&&k.num===f.num+x))==null?void 0:I.id;if(D){C=D;break}x-=1}g||(g=It(f,l,"up")),C||(C=It(f,l,"down")),i.modalNavUp.disabled=!g,i.modalNavUp.dataset.targetId=g??"",i.modalNavDown.disabled=!C,i.modalNavDown.dataset.targetId=C??"",i.modalNavLeft.disabled=!0,i.modalNavRight.disabled=!0}else{i.modalNavLeft.style.display="block",i.modalNavRight.style.display="block",i.modalNavUp.style.display="block",i.modalNavDown.style.display="block",i.modalNavUp.ariaLabel="往上一排",i.modalNavDown.ariaLabel="往下一排";const g={up:It(f,l,"up"),down:It(f,l,"down"),left:It(f,l,"left"),right:It(f,l,"right")};i.modalNavUp.disabled=!g.up,i.modalNavUp.dataset.targetId=g.up??"",i.modalNavDown.disabled=!g.down,i.modalNavDown.dataset.targetId=g.down??"",i.modalNavLeft.disabled=!g.left,i.modalNavLeft.dataset.targetId=g.left??"",i.modalNavRight.disabled=!g.right,i.modalNavRight.dataset.targetId=g.right??""}const{modalVerticalStallList:w}=i;if(y){b!==u&&(w.scrollTop=0),w.innerHTML="",w.style.display="flex";const g=n.filter(x=>x.id.startsWith(b)).sort((x,D)=>D.num-x.num),M=i.searchInput.value.toLowerCase().trim();g.forEach(x=>{const D=document.createElement("div");D.className="modal-vertical-stall-item",D.dataset.stallId=x.id,D.textContent=x.num.toString().padStart(2,"0"),x.promoData.length>0&&D.classList.add("has-promo");let k=!1;if(M!==""){const H=x.promoData.some(K=>K.promoUser.toLowerCase().includes(M)),Q=x.promoTags.some(K=>K.toLowerCase().includes(M));k=x.id.toLowerCase().includes(M)||x.stallTitle.toLowerCase().includes(M)||H||Q}k&&D.classList.add("is-search-match"),x.id===o&&D.classList.add("is-selected"),w.appendChild(D)});const C=w.querySelector(".is-selected");C&&requestAnimationFrame(()=>{C.scrollIntoView({behavior:"smooth",block:"center"})})}else w.innerHTML="",w.style.display="none";document.body.classList.add("body-modal-open"),i.modal.classList.remove("hidden"),i.modalNavControls.style.display="grid",i.modal.setAttribute("aria-hidden","true"),Bo(f,e)}function se(o){const{elements:e,magnifierController:n,uiState:i}=o;document.body.classList.remove("body-modal-open"),e.modal.classList.add("hidden"),e.modalNavControls.style.display="none",e.modal.setAttribute("aria-hidden","true"),Xe(e,n,i),n&&A.wasMagnifierVisible&&n.show(),A.wasMagnifierVisible=!1,e.modalMagnifierWrapper.style.display="none",e.modalVerticalStallList.style.display="none"}function Ho(o,e){var f;const{allStalls:n,uiState:i}=e,r=o.closest(".stall-group-area"),a=o.closest(".stall-area:not(.stall-group-area)"),d=(f=i.selectedStallElement)==null?void 0:f.dataset.stallId;if(r!=null&&r.dataset.rowId){const p=r.dataset.rowId;if(p===(d==null?void 0:d.substring(0,1)))return;const u=n.filter(T=>T.id.startsWith(p)).sort((T,m)=>m.num-T.num);u.length>0&&vt(u[0].id,e)}else if(a!=null&&a.dataset.stallId){const p=a.dataset.stallId;if(p===d)return;vt(p,e)}}function Uo(o){const{elements:e}=o;e.modalNavControls.addEventListener("click",s=>{const l=s.target.closest(".modal-nav-btn");l!=null&&l.dataset.targetId&&vt(l.dataset.targetId,o)}),e.modalVerticalStallList.addEventListener("click",s=>{const l=s.target.closest(".modal-vertical-stall-item");l!=null&&l.dataset.stallId&&vt(l.dataset.stallId,o)});const{modalMagnifierWrapper:n,modalMagnifier:i,modalMagnifierStallLayer:r}=e,a=()=>{A.isPanning&&(Ve(o,A.targetBgX,A.targetBgY),A.animationFrameId=requestAnimationFrame(a))},d=s=>{var v;if(!A.isPanning)return;s.type==="touchmove"&&s.preventDefault();const l=(v=s.touches)==null?void 0:v[0],b=l?l.clientX:s.clientX,L=l?l.clientY:s.clientY,y=b-A.panStartX,w=L-A.panStartY;!A.panHappened&&(Math.abs(y)>5||Math.abs(w)>5)&&(A.panHappened=!0,n.style.cursor="grabbing"),A.panHappened&&(A.targetBgX=A.initialBgX+y,A.targetBgY=A.initialBgY+w)},f=()=>{cancelAnimationFrame(A.animationFrameId),document.removeEventListener("mousemove",d),document.removeEventListener("touchmove",d),document.removeEventListener("mouseup",f),document.removeEventListener("touchend",f),!A.panHappened&&A.clickTarget&&Ho(A.clickTarget,o),A.isPanning=!1,A.clickTarget=null,n.style.cursor="grab",i.style.transition="",r.style.transition=""},p=s=>{var g,M;const l=s.target;if(l.closest("#modal-vertical-stall-list"))return;const b=l.closest(".stall-group-area"),L=(g=o.uiState.selectedStallElement)==null?void 0:g.dataset.stallId;if(b&&L){const C=b.dataset.rowId,x=L.substring(0,1);if(C===x)return}if("button"in s&&s.button!==0)return;A.isPanning=!0,A.panHappened=!1,A.clickTarget=s.target;const y=(M=s.touches)==null?void 0:M[0],w=y?y.clientX:s.clientX,v=y?y.clientY:s.clientY;A.panStartX=w,A.panStartY=v;const S=new DOMMatrix(window.getComputedStyle(r).transform);A.initialBgX=S.e,A.initialBgY=S.f,A.targetBgX=A.initialBgX,A.targetBgY=A.initialBgY,i.style.transition="none",r.style.transition="none";const I=r.querySelector(".modal-stall-highlight");I&&(I.style.visibility="hidden"),cancelAnimationFrame(A.animationFrameId),A.animationFrameId=requestAnimationFrame(a),document.addEventListener("mousemove",d),document.addEventListener("touchmove",d,{passive:!1}),document.addEventListener("mouseup",f,{once:!0}),document.addEventListener("touchend",f,{once:!0})};n.addEventListener("mousedown",p),n.addEventListener("touchstart",p,{passive:!1});const u=()=>Po(e);e.modalBody.addEventListener("click",s=>{const l=s.target;if(l instanceof HTMLImageElement){let b="";const L=l.parentElement;l.classList.contains("official-stall-image")?b=l.src:l.closest(".promo-html-content")&&L instanceof HTMLAnchorElement?RegExp(/https?:\/\/.*\.(jpg|jpeg|png|gif|webp)(\?.*)?$/).test((L==null?void 0:L.href)??"")&&(b=l.alt,s.stopPropagation(),s.preventDefault()):b=l.src,Oo(b,l.alt,e)}}),e.imageLightboxClose.addEventListener("click",u),e.imageLightbox.addEventListener("click",s=>{(s.target===e.imageLightbox||s.target===e.imageLightbox.querySelector(".lightbox-overlay"))&&u()}),e.modalClose.addEventListener("click",()=>se(o)),e.modalOverlay.addEventListener("click",()=>se(o)),document.addEventListener("keydown",s=>{if(!e.imageLightbox.classList.contains("hidden")){s.key==="Escape"&&u();return}if(!e.modal.classList.contains("hidden"))switch(s.key){case"Escape":se(o);break;case"ArrowUp":e.modalNavUp.click();break;case"ArrowDown":e.modalNavDown.click();break;case"ArrowLeft":e.modalNavLeft.click();break;case"ArrowRight":e.modalNavRight.click();break}});const{modalNavControls:T,tooltip:m}=e;T.addEventListener("mouseover",s=>{const l=s.target.closest(".modal-nav-btn");if(l instanceof HTMLButtonElement&&!l.disabled){const b=l.ariaLabel;if(b){m.innerHTML=b;const L=l.getBoundingClientRect();m.classList.remove("hidden");const y=m.getBoundingClientRect(),w=L.top-y.height-8,v=L.left+L.width/2-y.width/2;m.style.left=`${v}px`,m.style.top=`${w}px`}}else m.classList.add("hidden")}),T.addEventListener("mouseleave",()=>{m.classList.add("hidden")})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Fo(o){const e=()=>Ro.every(i=>document.getElementById(i)),n=()=>{e()?o():requestAnimationFrame(n)};n()}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function $o(o){ct.forEach(e=>{const n=document.createElement("div");n.className="debug-border",n.style.top=`${e.border.top}%`,n.style.left=`${e.border.left}%`,n.style.width=`${e.border.right-e.border.left}%`,n.style.height=`${e.border.bottom-e.border.top}%`;const i=document.createElement("span");i.textContent=e.id,n.appendChild(i),o.appendChild(n)})}async function Yo(){const o=No();new URLSearchParams(window.location.search).get("debug")==="true"&&o.mapContainer.classList.add("debug-mode"),o.instructionsEl.textContent="正在載入地圖與攤位資料",o.instructionsEl.classList.add("loading-text");const n=new Promise((i,r)=>{o.mapImage.complete?i():(o.mapImage.onload=()=>i(),o.mapImage.onerror=()=>r(new Error("Map image failed to load.")))});try{const[i]=await Promise.all([oo(),n]);if(o.instructionsEl.classList.remove("loading-text"),i.length===0){o.mapContainer.innerHTML='<p style="color: red; padding: 20px;"><b>無法載入攤位資料：</b><br>請檢查您的 Google Sheet 是否已「發佈至網路」、網址是否正確，或檢查您的網路連線。</p>',o.instructionsEl.textContent="載入失敗";return}const r=Mo(i),d=window.matchMedia("(max-width: 768px)").matches,f={allStalls:r,elements:o,magnifierController:null,uiState:Ot,isMobile:d},p=m=>{const s=m.closest(".stall-group-area"),l=m.closest(".stall-area:not(.stall-group-area)");if(s!=null&&s.dataset.rowId){const b=s.dataset.rowId,L=r.filter(y=>y.id.startsWith(b)).sort((y,w)=>w.num-y.num);L.length>0&&vt(L[0].id,f)}else l!=null&&l.dataset.stallId&&vt(l.dataset.stallId,f)},u=xo(o.mapContainer,o.mapImage,o.magnifierWrapper,o.magnifier,o.magnifierStallLayer,{prev:o.magnifierRowIndicatorPrev,current:o.magnifierRowIndicatorCurrent,next:o.magnifierRowIndicatorNext},o.toggleMagnifierBtn,p,d);f.magnifierController=u,Do(r,o,u,Ot),$o(o.mapContainer),Uo(f),o.searchInput.addEventListener("input",()=>{const m=o.searchInput.value.toLowerCase().trim(),s=new Set;r.forEach(l=>{const b=document.querySelector(`.stall-area[data-stall-id="${l.id}"]`);if(!b)return;let L=!1;if(m!==""){const y=l.promoData.some(v=>v.promoUser.toLowerCase().includes(m)),w=l.promoTags.some(v=>v.toLowerCase().includes(m));L=l.id.toLowerCase().includes(m)||l.stallTitle.toLowerCase().includes(m)||y||w}ce(b,"is-search-match",L,u,Ot),L&&s.add(l.id.substring(0,1))}),ct.forEach(l=>{document.querySelectorAll(`.stall-group-area[data-row-id="${l.id}"]`).forEach(L=>{const y=s.has(l.id);L.classList.toggle("is-search-match",y)})})});const T=m=>{const s=m.target;s.closest("#magnifier-wrapper")||(m.type==="touchstart"&&m.preventDefault(),p(s))};d?(o.instructionsEl.textContent="點擊按鈕可用放大鏡，或直接點擊攤位查看宣傳。",o.mapContainer.addEventListener("mousedown",T,{passive:!1}),o.mapContainer.addEventListener("touchstart",T,{passive:!1})):(o.instructionsEl.textContent="點擊按鈕顯示/隱藏放大鏡並拖曳。點擊攤位(含放大鏡內)可看宣傳。",document.addEventListener("mousemove",m=>{Ot.selectedStallElement||(o.tooltip.style.left=`${m.clientX+15}px`,o.tooltip.style.top=`${m.clientY+15}px`)}),o.mapContainer.addEventListener("mouseover",m=>{var b;const l=m.target.closest(".stall-area:not(.stall-group-area)");if(l&&!Ot.selectedStallElement){const L=l.dataset.stallId,y=r.find(w=>w.id===L);if(y){const w=(b=y.promoData)==null?void 0:b.map(v=>v.promoUser).filter((v,S,I)=>I.indexOf(v)===S).join(",");o.tooltip.innerHTML=`<strong>${y.stallTitle}</strong><br><small>${y.id}${w?` / ${w}`:""}</small>`,o.tooltip.classList.remove("hidden")}}}),o.mapContainer.addEventListener("mouseout",m=>{m.target.classList.contains("stall-area")&&o.tooltip.classList.add("hidden")}),o.mapContainer.addEventListener("mousedown",T))}catch(i){console.error("Failed to initialize app:",i),o.instructionsEl.classList.remove("loading-text"),o.instructionsEl.textContent="地圖或資料載入失敗，請重新整理頁面。"}}Fo(Yo);
