(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const xe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSekTVRYingSPdcpjSzVazPOJRJr_SxAyQV1lvqvgzvoW6BtnP8aEoVOo1sZSF6tJ27tLXv7JvxCPP9/pub?output=csv&gid=0&single=true";function Re(n){const e=n.trim().replace(/\r\n/g,`
`).split(`
`);if(e.length<2)return[];const o=a=>{const d=[];let m="",p=!1;for(let u=0;u<a.length;u++){const T=a[u];T==='"'?p&&a[u+1]==='"'?(m+='"',u++):p=!p:T===","&&!p?(d.push(m),m=""):m+=T}return d.push(m),d},i=o(e[1]).map(a=>a.trim()),s=[];for(let a=2;a<e.length;a++){const d=e[a];if(!d.trim())continue;const m=o(d),p={};let u=!1;i.forEach((T,f)=>{const r=m[f]||"";p[T]=r,r.trim()!==""&&(u=!0)}),u&&s.push(p)}return s}async function oo(){const n=`${xe}&_=${Date.now()}`;try{const e=await fetch(n);if(e.ok){const o=await e.text();return Re(o)}console.warn(`Initial fetch with timestamp failed with status: ${e.status}. Retrying without timestamp.`)}catch(e){console.warn("Initial fetch with timestamp failed with a network error. Retrying without timestamp.",e)}console.log("Attempting fallback fetch without cache-busting timestamp.");try{const e=await fetch(xe);if(!e.ok)throw new Error(`Fallback fetch failed: ${e.status} ${e.statusText}`);const o=await e.text();return Re(o)}catch(e){return console.error("Error fetching or parsing stall data after fallback:",e),[]}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ct=[{id:"A",num:1,coords:{top:87.8,left:91,width:1.05,height:1.4},border:{top:86.15,left:52.5,bottom:89.2,right:92.05}},{id:"B",num:1,coords:{top:83.1,left:91,width:1.05,height:1.4},border:{top:81.45,left:52.5,bottom:84.5,right:92.05}},{id:"C",num:1,coords:{top:78.4,left:91,width:1.05,height:1.4},border:{top:76.75,left:52.5,bottom:79.8,right:92.05}},{id:"D",num:1,coords:{top:73.5,left:91,width:1.05,height:1.4},border:{top:71.85,left:52.5,bottom:74.9,right:92.05}},{id:"E",num:1,coords:{top:68.5,left:91,width:1.05,height:1.4},border:{top:66.85,left:52.5,bottom:69.9,right:92.05}},{id:"F",num:1,coords:{top:63.9,left:91,width:1.05,height:1.4},border:{top:62.25,left:52.5,bottom:65.3,right:92.05}},{id:"G",num:1,coords:{top:59.1,left:91,width:1.05,height:1.4},border:{top:57.45,left:52.5,bottom:60.5,right:92.05}},{id:"H",num:1,coords:{top:54.3,left:91,width:1.05,height:1.4},border:{top:52.65,left:52.5,bottom:55.7,right:92.05}},{id:"I",num:1,coords:{top:49.5,left:91,width:1.05,height:1.4},border:{top:47.85,left:52.5,bottom:50.9,right:92.05}},{id:"J",num:1,coords:{top:44.5,left:91,width:1.05,height:1.4},border:{top:42.85,left:52.5,bottom:45.9,right:92.05}},{id:"K",num:1,coords:{top:39.6,left:91,width:1.05,height:1.4},border:{top:37.95,left:52.5,bottom:41,right:92.05}},{id:"L",num:1,coords:{top:34.8,left:91,width:1.05,height:1.4},border:{top:33.15,left:52.5,bottom:36.2,right:92.05}},{id:"M",num:1,coords:{top:30.1,left:91,width:1.05,height:1.4},border:{top:28.45,left:52.5,bottom:31.5,right:92.05}},{id:"N",num:1,coords:{top:25.2,left:91,width:1.05,height:1.4},border:{top:23.55,left:52.5,bottom:26.6,right:92.05}},{id:"O",num:1,coords:{top:20.4,left:91,width:1.05,height:1.4},border:{top:18.75,left:52.5,bottom:21.8,right:92.05}},{id:"P",num:1,coords:{top:15.6,left:91,width:1.05,height:1.4},border:{top:13.95,left:52.5,bottom:17,right:92.05}},{id:"Q",num:1,coords:{top:10.8,left:91,width:1.05,height:1.4},border:{top:9.15,left:52.5,bottom:12.2,right:92.05}},{id:"R",num:1,coords:{top:87.8,left:46.3,width:1.05,height:1.4},border:{top:86.15,left:7.8,bottom:89.2,right:47.35}},{id:"S",num:1,coords:{top:83.1,left:46.3,width:1.05,height:1.4},border:{top:81.45,left:7.8,bottom:84.5,right:47.35}},{id:"T",num:1,coords:{top:78.4,left:46.3,width:1.05,height:1.4},border:{top:76.75,left:7.8,bottom:79.8,right:47.35}},{id:"U",num:1,coords:{top:73.5,left:46.3,width:1.05,height:1.4},border:{top:71.85,left:7.8,bottom:74.9,right:47.35}},{id:"V",num:1,coords:{top:68.7,left:46.3,width:1.05,height:1.4},border:{top:67.05,left:7.8,bottom:70.1,right:47.35}},{id:"W",num:1,coords:{top:63.9,left:46.3,width:1.05,height:1.4},border:{top:62.25,left:7.8,bottom:65.3,right:47.35}},{id:"X",num:1,coords:{top:59.1,left:46.3,width:1.05,height:1.4},border:{top:57.45,left:7.8,bottom:60.5,right:47.35}},{id:"Y",num:1,coords:{top:54.3,left:46.3,width:1.05,height:1.4},border:{top:52.65,left:7.8,bottom:55.7,right:47.35}},{id:"Z",num:1,coords:{top:49.5,left:46.3,width:1.05,height:1.4},border:{top:47.85,left:7.8,bottom:50.9,right:47.35}},{id:"鼠",num:1,coords:{top:44.5,left:46.3,width:1.05,height:1.4},border:{top:42.85,left:7.8,bottom:45.9,right:47.35}},{id:"牛",num:1,coords:{top:39.6,left:46.3,width:1.05,height:1.4},border:{top:37.95,left:7.8,bottom:41,right:47.35}},{id:"虎",num:1,coords:{top:34.9,left:46.3,width:1.05,height:1.4},border:{top:33.25,left:7.8,bottom:36.3,right:47.35}},{id:"兔",num:1,coords:{top:30.1,left:46.3,width:1.05,height:1.4},border:{top:28.45,left:7.8,bottom:31.5,right:47.35}},{id:"龍",num:1,coords:{top:25.2,left:46.3,width:1.05,height:1.4},border:{top:23.55,left:7.8,bottom:26.6,right:47.35}},{id:"蛇",num:1,coords:{top:20.4,left:46.3,width:1.05,height:1.4},border:{top:18.75,left:7.8,bottom:21.8,right:47.35}},{id:"馬",num:1,coords:{top:15.6,left:46.3,width:1.05,height:1.4},border:{top:13.95,left:7.8,bottom:17,right:47.35}},{id:"羊",num:1,coords:{top:10.8,left:46.3,width:1.05,height:1.4},border:{top:9.15,left:7.8,bottom:12.2,right:47.35}},{id:"猴",num:1,coords:{top:73.5,left:4.5,width:1.1,height:1.44},border:{top:52.7,left:4.5,bottom:74.9,right:5.55},isGrouped:!0},{id:"雞",num:1,coords:{top:43.7,left:4.5,width:1.1,height:1.44},border:{top:23,left:4.5,bottom:45.6,right:5.55},isGrouped:!0},{id:"狗",num:1,coords:{top:18.2,left:4.5,width:1.1,height:1.44},border:{top:7.5,left:4.5,bottom:19.8,right:5.55},isGrouped:!0},{id:"特",num:1,coords:{top:84.4,left:4.15,width:1.8,height:2.41},border:{top:77.15,left:4.15,bottom:87.2,right:5.75},isGrouped:!0},{id:"商",num:1,coords:{top:89.5,left:4.15,width:1.8,height:2.41},border:{top:87.5,left:4.15,bottom:91.5,right:5.75},isGrouped:!0},{id:"範",num:1,coords:{top:.5,left:91,width:5,height:5},border:{top:.5,left:86,bottom:5.5,right:96}}];/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:$e,setPrototypeOf:Ne,isFrozen:no,getPrototypeOf:io,getOwnPropertyDescriptor:ao}=Object;let{freeze:q,seal:tt,create:ze}=Object,{apply:re,construct:le}=typeof Reflect<"u"&&Reflect;q||(q=function(e){return e});tt||(tt=function(e){return e});re||(re=function(e,o,i){return e.apply(o,i)});le||(le=function(e,o){return new e(...o)});const Yt=j(Array.prototype.forEach),so=j(Array.prototype.lastIndexOf),De=j(Array.prototype.pop),Ct=j(Array.prototype.push),ro=j(Array.prototype.splice),Gt=j(String.prototype.toLowerCase),ee=j(String.prototype.toString),Oe=j(String.prototype.match),xt=j(String.prototype.replace),lo=j(String.prototype.indexOf),co=j(String.prototype.trim),et=j(Object.prototype.hasOwnProperty),V=j(RegExp.prototype.test),Rt=mo(TypeError);function j(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var o=arguments.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=arguments[s];return re(n,e,i)}}function mo(n){return function(){for(var e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];return le(n,o)}}function _(n,e){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Gt;Ne&&Ne(n,null);let i=e.length;for(;i--;){let s=e[i];if(typeof s=="string"){const a=o(s);a!==s&&(no(e)||(e[i]=a),s=a)}n[s]=!0}return n}function fo(n){for(let e=0;e<n.length;e++)et(n,e)||(n[e]=null);return n}function lt(n){const e=ze(null);for(const[o,i]of $e(n))et(n,o)&&(Array.isArray(i)?e[o]=fo(i):i&&typeof i=="object"&&i.constructor===Object?e[o]=lt(i):e[o]=i);return e}function Nt(n,e){for(;n!==null;){const i=ao(n,e);if(i){if(i.get)return j(i.get);if(typeof i.value=="function")return j(i.value)}n=io(n)}function o(){return null}return o}const ke=q(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),oe=q(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ne=q(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),uo=q(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ie=q(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),po=q(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Pe=q(["#text"]),Be=q(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),ae=q(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),He=q(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Wt=q(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ho=tt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),go=tt(/<%[\w\W]*|[\w\W]*%>/gm),Eo=tt(/\$\{[\w\W]*/gm),bo=tt(/^data-[\-\w.\u00B7-\uFFFF]+$/),To=tt(/^aria-[\-\w]+$/),Ye=tt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),wo=tt(/^(?:\w+script|data):/i),yo=tt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),We=tt(/^html$/i),Lo=tt(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ue=Object.freeze({__proto__:null,ARIA_ATTR:To,ATTR_WHITESPACE:yo,CUSTOM_ELEMENT:Lo,DATA_ATTR:bo,DOCTYPE_NAME:We,ERB_EXPR:go,IS_ALLOWED_URI:Ye,IS_SCRIPT_OR_DATA:wo,MUSTACHE_EXPR:ho,TMPLIT_EXPR:Eo});const Dt={element:1,text:3,progressingInstruction:7,comment:8,document:9},Io=function(){return typeof window>"u"?null:window},vo=function(e,o){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let i=null;const s="data-tt-policy-suffix";o&&o.hasAttribute(s)&&(i=o.getAttribute(s));const a="dompurify"+(i?"#"+i:"");try{return e.createPolicy(a,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+a+" could not be created."),null}},Fe=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Ge(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Io();const e=E=>Ge(E);if(e.version="3.2.6",e.removed=[],!n||!n.document||n.document.nodeType!==Dt.document||!n.Element)return e.isSupported=!1,e;let{document:o}=n;const i=o,s=i.currentScript,{DocumentFragment:a,HTMLTemplateElement:d,Node:m,Element:p,NodeFilter:u,NamedNodeMap:T=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:f,DOMParser:r,trustedTypes:l}=n,b=p.prototype,L=Nt(b,"cloneNode"),w=Nt(b,"remove"),y=Nt(b,"nextSibling"),v=Nt(b,"childNodes"),S=Nt(b,"parentNode");if(typeof d=="function"){const E=o.createElement("template");E.content&&E.content.ownerDocument&&(o=E.content.ownerDocument)}let I,g="";const{implementation:M,createNodeIterator:C,createDocumentFragment:x,getElementsByTagName:D}=o,{importNode:P}=i;let H=Fe();e.isSupported=typeof $e=="function"&&typeof S=="function"&&M&&M.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Q,ERB_EXPR:K,TMPLIT_EXPR:dt,DATA_ATTR:R,ARIA_ATTR:N,IS_SCRIPT_OR_DATA:U,ATTR_WHITESPACE:$,CUSTOM_ELEMENT:z}=Ue;let{IS_ALLOWED_URI:J}=Ue,B=null;const mt=_({},[...ke,...oe,...ne,...ie,...Pe]);let O=null;const ft=_({},[...Be,...ae,...He,...Wt]);let k=Object.seal(ze(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),nt=null,ut=null,_t=!0,pt=!0,de=!1,me=!0,gt=!1,Pt=!0,ht=!1,Xt=!1,Vt=!1,Et=!1,Bt=!1,Ht=!1,fe=!0,ue=!1;const qe="user-content-";let qt=!0,At=!1,bt={},Tt=null;const pe=_({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let he=null;const ge=_({},["audio","video","img","source","image","track"]);let jt=null;const Ee=_({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ut="http://www.w3.org/1998/Math/MathML",Ft="http://www.w3.org/2000/svg",at="http://www.w3.org/1999/xhtml";let wt=at,Kt=!1,Zt=null;const je=_({},[Ut,Ft,at],ee);let $t=_({},["mi","mo","mn","ms","mtext"]),zt=_({},["annotation-xml"]);const Ke=_({},["title","style","font","a","script"]);let St=null;const Ze=["application/xhtml+xml","text/html"],Je="text/html";let W=null,yt=null;const Qe=o.createElement("form"),be=function(t){return t instanceof RegExp||t instanceof Function},Jt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(yt&&yt===t)){if((!t||typeof t!="object")&&(t={}),t=lt(t),St=Ze.indexOf(t.PARSER_MEDIA_TYPE)===-1?Je:t.PARSER_MEDIA_TYPE,W=St==="application/xhtml+xml"?ee:Gt,B=et(t,"ALLOWED_TAGS")?_({},t.ALLOWED_TAGS,W):mt,O=et(t,"ALLOWED_ATTR")?_({},t.ALLOWED_ATTR,W):ft,Zt=et(t,"ALLOWED_NAMESPACES")?_({},t.ALLOWED_NAMESPACES,ee):je,jt=et(t,"ADD_URI_SAFE_ATTR")?_(lt(Ee),t.ADD_URI_SAFE_ATTR,W):Ee,he=et(t,"ADD_DATA_URI_TAGS")?_(lt(ge),t.ADD_DATA_URI_TAGS,W):ge,Tt=et(t,"FORBID_CONTENTS")?_({},t.FORBID_CONTENTS,W):pe,nt=et(t,"FORBID_TAGS")?_({},t.FORBID_TAGS,W):lt({}),ut=et(t,"FORBID_ATTR")?_({},t.FORBID_ATTR,W):lt({}),bt=et(t,"USE_PROFILES")?t.USE_PROFILES:!1,_t=t.ALLOW_ARIA_ATTR!==!1,pt=t.ALLOW_DATA_ATTR!==!1,de=t.ALLOW_UNKNOWN_PROTOCOLS||!1,me=t.ALLOW_SELF_CLOSE_IN_ATTR!==!1,gt=t.SAFE_FOR_TEMPLATES||!1,Pt=t.SAFE_FOR_XML!==!1,ht=t.WHOLE_DOCUMENT||!1,Et=t.RETURN_DOM||!1,Bt=t.RETURN_DOM_FRAGMENT||!1,Ht=t.RETURN_TRUSTED_TYPE||!1,Vt=t.FORCE_BODY||!1,fe=t.SANITIZE_DOM!==!1,ue=t.SANITIZE_NAMED_PROPS||!1,qt=t.KEEP_CONTENT!==!1,At=t.IN_PLACE||!1,J=t.ALLOWED_URI_REGEXP||Ye,wt=t.NAMESPACE||at,$t=t.MATHML_TEXT_INTEGRATION_POINTS||$t,zt=t.HTML_INTEGRATION_POINTS||zt,k=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&be(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(k.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&be(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(k.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(k.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),gt&&(pt=!1),Bt&&(Et=!0),bt&&(B=_({},Pe),O=[],bt.html===!0&&(_(B,ke),_(O,Be)),bt.svg===!0&&(_(B,oe),_(O,ae),_(O,Wt)),bt.svgFilters===!0&&(_(B,ne),_(O,ae),_(O,Wt)),bt.mathMl===!0&&(_(B,ie),_(O,He),_(O,Wt))),t.ADD_TAGS&&(B===mt&&(B=lt(B)),_(B,t.ADD_TAGS,W)),t.ADD_ATTR&&(O===ft&&(O=lt(O)),_(O,t.ADD_ATTR,W)),t.ADD_URI_SAFE_ATTR&&_(jt,t.ADD_URI_SAFE_ATTR,W),t.FORBID_CONTENTS&&(Tt===pe&&(Tt=lt(Tt)),_(Tt,t.FORBID_CONTENTS,W)),qt&&(B["#text"]=!0),ht&&_(B,["html","head","body"]),B.table&&(_(B,["tbody"]),delete nt.tbody),t.TRUSTED_TYPES_POLICY){if(typeof t.TRUSTED_TYPES_POLICY.createHTML!="function")throw Rt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof t.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Rt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');I=t.TRUSTED_TYPES_POLICY,g=I.createHTML("")}else I===void 0&&(I=vo(l,s)),I!==null&&typeof g=="string"&&(g=I.createHTML(""));q&&q(t),yt=t}},Te=_({},[...oe,...ne,...uo]),we=_({},[...ie,...po]),to=function(t){let c=S(t);(!c||!c.tagName)&&(c={namespaceURI:wt,tagName:"template"});const h=Gt(t.tagName),F=Gt(c.tagName);return Zt[t.namespaceURI]?t.namespaceURI===Ft?c.namespaceURI===at?h==="svg":c.namespaceURI===Ut?h==="svg"&&(F==="annotation-xml"||$t[F]):!!Te[h]:t.namespaceURI===Ut?c.namespaceURI===at?h==="math":c.namespaceURI===Ft?h==="math"&&zt[F]:!!we[h]:t.namespaceURI===at?c.namespaceURI===Ft&&!zt[F]||c.namespaceURI===Ut&&!$t[F]?!1:!we[h]&&(Ke[h]||!Te[h]):!!(St==="application/xhtml+xml"&&Zt[t.namespaceURI]):!1},it=function(t){Ct(e.removed,{element:t});try{S(t).removeChild(t)}catch{w(t)}},Lt=function(t,c){try{Ct(e.removed,{attribute:c.getAttributeNode(t),from:c})}catch{Ct(e.removed,{attribute:null,from:c})}if(c.removeAttribute(t),t==="is")if(Et||Bt)try{it(c)}catch{}else try{c.setAttribute(t,"")}catch{}},ye=function(t){let c=null,h=null;if(Vt)t="<remove></remove>"+t;else{const Y=Oe(t,/^[\r\n\t ]+/);h=Y&&Y[0]}St==="application/xhtml+xml"&&wt===at&&(t='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+t+"</body></html>");const F=I?I.createHTML(t):t;if(wt===at)try{c=new r().parseFromString(F,St)}catch{}if(!c||!c.documentElement){c=M.createDocument(wt,"template",null);try{c.documentElement.innerHTML=Kt?g:F}catch{}}const G=c.body||c.documentElement;return t&&h&&G.insertBefore(o.createTextNode(h),G.childNodes[0]||null),wt===at?D.call(c,ht?"html":"body")[0]:ht?c.documentElement:G},Le=function(t){return C.call(t.ownerDocument||t,t,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Qt=function(t){return t instanceof f&&(typeof t.nodeName!="string"||typeof t.textContent!="string"||typeof t.removeChild!="function"||!(t.attributes instanceof T)||typeof t.removeAttribute!="function"||typeof t.setAttribute!="function"||typeof t.namespaceURI!="string"||typeof t.insertBefore!="function"||typeof t.hasChildNodes!="function")},Ie=function(t){return typeof m=="function"&&t instanceof m};function st(E,t,c){Yt(E,h=>{h.call(e,t,c,yt)})}const ve=function(t){let c=null;if(st(H.beforeSanitizeElements,t,null),Qt(t))return it(t),!0;const h=W(t.nodeName);if(st(H.uponSanitizeElement,t,{tagName:h,allowedTags:B}),Pt&&t.hasChildNodes()&&!Ie(t.firstElementChild)&&V(/<[/\w!]/g,t.innerHTML)&&V(/<[/\w!]/g,t.textContent)||t.nodeType===Dt.progressingInstruction||Pt&&t.nodeType===Dt.comment&&V(/<[/\w]/g,t.data))return it(t),!0;if(!B[h]||nt[h]){if(!nt[h]&&Ae(h)&&(k.tagNameCheck instanceof RegExp&&V(k.tagNameCheck,h)||k.tagNameCheck instanceof Function&&k.tagNameCheck(h)))return!1;if(qt&&!Tt[h]){const F=S(t)||t.parentNode,G=v(t)||t.childNodes;if(G&&F){const Y=G.length;for(let Z=Y-1;Z>=0;--Z){const rt=L(G[Z],!0);rt.__removalCount=(t.__removalCount||0)+1,F.insertBefore(rt,y(t))}}}return it(t),!0}return t instanceof p&&!to(t)||(h==="noscript"||h==="noembed"||h==="noframes")&&V(/<\/no(script|embed|frames)/i,t.innerHTML)?(it(t),!0):(gt&&t.nodeType===Dt.text&&(c=t.textContent,Yt([Q,K,dt],F=>{c=xt(c,F," ")}),t.textContent!==c&&(Ct(e.removed,{element:t.cloneNode()}),t.textContent=c)),st(H.afterSanitizeElements,t,null),!1)},_e=function(t,c,h){if(fe&&(c==="id"||c==="name")&&(h in o||h in Qe))return!1;if(!(pt&&!ut[c]&&V(R,c))){if(!(_t&&V(N,c))){if(!O[c]||ut[c]){if(!(Ae(t)&&(k.tagNameCheck instanceof RegExp&&V(k.tagNameCheck,t)||k.tagNameCheck instanceof Function&&k.tagNameCheck(t))&&(k.attributeNameCheck instanceof RegExp&&V(k.attributeNameCheck,c)||k.attributeNameCheck instanceof Function&&k.attributeNameCheck(c))||c==="is"&&k.allowCustomizedBuiltInElements&&(k.tagNameCheck instanceof RegExp&&V(k.tagNameCheck,h)||k.tagNameCheck instanceof Function&&k.tagNameCheck(h))))return!1}else if(!jt[c]){if(!V(J,xt(h,$,""))){if(!((c==="src"||c==="xlink:href"||c==="href")&&t!=="script"&&lo(h,"data:")===0&&he[t])){if(!(de&&!V(U,xt(h,$,"")))){if(h)return!1}}}}}}return!0},Ae=function(t){return t!=="annotation-xml"&&Oe(t,z)},Se=function(t){st(H.beforeSanitizeAttributes,t,null);const{attributes:c}=t;if(!c||Qt(t))return;const h={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:O,forceKeepAttr:void 0};let F=c.length;for(;F--;){const G=c[F],{name:Y,namespaceURI:Z,value:rt}=G,Mt=W(Y),te=rt;let X=Y==="value"?te:co(te);if(h.attrName=Mt,h.attrValue=X,h.keepAttr=!0,h.forceKeepAttr=void 0,st(H.uponSanitizeAttribute,t,h),X=h.attrValue,ue&&(Mt==="id"||Mt==="name")&&(Lt(Y,t),X=qe+X),Pt&&V(/((--!?|])>)|<\/(style|title)/i,X)){Lt(Y,t);continue}if(h.forceKeepAttr)continue;if(!h.keepAttr){Lt(Y,t);continue}if(!me&&V(/\/>/i,X)){Lt(Y,t);continue}gt&&Yt([Q,K,dt],Ce=>{X=xt(X,Ce," ")});const Me=W(t.nodeName);if(!_e(Me,Mt,X)){Lt(Y,t);continue}if(I&&typeof l=="object"&&typeof l.getAttributeType=="function"&&!Z)switch(l.getAttributeType(Me,Mt)){case"TrustedHTML":{X=I.createHTML(X);break}case"TrustedScriptURL":{X=I.createScriptURL(X);break}}if(X!==te)try{Z?t.setAttributeNS(Z,Y,X):t.setAttribute(Y,X),Qt(t)?it(t):De(e.removed)}catch{Lt(Y,t)}}st(H.afterSanitizeAttributes,t,null)},eo=function E(t){let c=null;const h=Le(t);for(st(H.beforeSanitizeShadowDOM,t,null);c=h.nextNode();)st(H.uponSanitizeShadowNode,c,null),ve(c),Se(c),c.content instanceof a&&E(c.content);st(H.afterSanitizeShadowDOM,t,null)};return e.sanitize=function(E){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=null,h=null,F=null,G=null;if(Kt=!E,Kt&&(E="<!-->"),typeof E!="string"&&!Ie(E))if(typeof E.toString=="function"){if(E=E.toString(),typeof E!="string")throw Rt("dirty is not a string, aborting")}else throw Rt("toString is not a function");if(!e.isSupported)return E;if(Xt||Jt(t),e.removed=[],typeof E=="string"&&(At=!1),At){if(E.nodeName){const rt=W(E.nodeName);if(!B[rt]||nt[rt])throw Rt("root node is forbidden and cannot be sanitized in-place")}}else if(E instanceof m)c=ye("<!---->"),h=c.ownerDocument.importNode(E,!0),h.nodeType===Dt.element&&h.nodeName==="BODY"||h.nodeName==="HTML"?c=h:c.appendChild(h);else{if(!Et&&!gt&&!ht&&E.indexOf("<")===-1)return I&&Ht?I.createHTML(E):E;if(c=ye(E),!c)return Et?null:Ht?g:""}c&&Vt&&it(c.firstChild);const Y=Le(At?E:c);for(;F=Y.nextNode();)ve(F),Se(F),F.content instanceof a&&eo(F.content);if(At)return E;if(Et){if(Bt)for(G=x.call(c.ownerDocument);c.firstChild;)G.appendChild(c.firstChild);else G=c;return(O.shadowroot||O.shadowrootmode)&&(G=P.call(i,G,!0)),G}let Z=ht?c.outerHTML:c.innerHTML;return ht&&B["!doctype"]&&c.ownerDocument&&c.ownerDocument.doctype&&c.ownerDocument.doctype.name&&V(We,c.ownerDocument.doctype.name)&&(Z="<!DOCTYPE "+c.ownerDocument.doctype.name+`>
`+Z),gt&&Yt([Q,K,dt],rt=>{Z=xt(Z,rt," ")}),I&&Ht?I.createHTML(Z):Z},e.setConfig=function(){let E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Jt(E),Xt=!0},e.clearConfig=function(){yt=null,Xt=!1},e.isValidAttribute=function(E,t,c){yt||Jt({});const h=W(E),F=W(t);return _e(h,F,c)},e.addHook=function(E,t){typeof t=="function"&&Ct(H[E],t)},e.removeHook=function(E,t){if(t!==void 0){const c=so(H[E],t);return c===-1?void 0:ro(H[E],c,1)[0]}return De(H[E])},e.removeHooks=function(E){H[E]=[]},e.removeAllHooks=function(){H=Fe()},e}var kt=Ge();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const _o=new Map(ct.map(n=>[n.id,n]));function Ao(n,e){return e?e.split(";").map((o,i)=>{const s=`${n}-宣傳車${i+1}`,a=o.trim();return{text:s,href:a}}).filter(o=>o!==null&&!!o.text&&!!o.href):[]}function So(n){const e=document.createElement("div");return e.innerHTML=n,e.querySelectorAll("iframe").forEach(o=>{const i=o.getAttribute("width"),s=o.getAttribute("height");i&&(o.style.width="100%",o.removeAttribute("width")),s&&(o.style.height=`${s}px`,o.removeAttribute("height"))}),e.innerHTML}function Mo(n){return n?n.split(";").map(e=>kt.sanitize((e==null?void 0:e.trim())??"")).filter(e=>e):[]}function Co(n){const e=new Map;return n.forEach(o=>{const i=o.id||o.stallId;if(!i)return;let s=e.get(i);if(!s){const p=i.substring(0,1),u=parseInt(o.num,10),T=parseInt(o.stallCnt,10)||1,f=_o.get(p);if(!f||isNaN(u)){console.warn(`Could not calculate position for stall ID: ${i}. Skipping base creation.`);return}const r=f.coords;let l,b;if(p!=="狗"&&p!=="雞"&&p!=="猴"&&p!=="特"&&p!=="商"){const w=u>36?72-u:u;let y=0,v=r.top,S=r.left;u>24&&u<=48?y=1.75:u<=12||u>=61?y=0:y=.9,u>36?(v=v-r.height-.25,S=r.left-w%72*r.width-y):(S=r.left-(w-1)*r.width-y,T>1&&(S-=(T-1)*r.width));const I=parseFloat(S.toFixed(2)),g=r.width*T;l={top:`${v}%`,left:`${I}%`,width:`${g}%`,height:`${r.height}%`},b={top:v,left:I,width:g,height:r.height}}else{let w=u,y=0;p==="狗"?u>=4&&u<16?(w=3,y=.8):u>=16&&(w=u-12,y=.4):p==="雞"?u>=4&&u<21?(w=3,y=.8):u>=21&&(w=u-17,y=.4):p==="猴"&&(u>=4&&u<23?(w=3,y=.8):u>=23&&(w=u-19,y=.5));let v=r.top-r.height*(w-1)-y;T>1&&(v-=(T-1)*r.height);const S=parseFloat(v.toFixed(2)),I=r.height*T;l={top:`${S}%`,left:`${r.left}%`,width:`${r.width}%`,height:`${I}%`},b={top:S,left:r.left,width:r.width,height:I}}let L=o.stallImg||void 0;L&&L.startsWith("assets/2025/")&&(L=`https://cdn.jsdelivr.net/gh/v4724/nice-0816@d24cd07/${L}`),s={id:i,num:u,stallCnt:T,coords:l,numericCoords:b,stallTitle:o.stallTitle||"N/A",stallImg:L,stallLink:o.stallLink||void 0,promoData:[],promoTags:[]},e.set(i,s)}const a=kt.sanitize(o.promoUser||""),d=kt.sanitize(o.promoAvatar||"");let m=o.promoHTML||"";if(m.includes("iframe")&&m.includes("https://www.facebook.com/plugins")?(m=So(m),m=kt.sanitize(m||"",{ADD_TAGS:["iframe"],FORBID_TAGS:[],ALLOWED_URI_REGEXP:/^https:\/\/(www\.)?facebook\.com\/plugins\//i})):m=kt.sanitize(m||""),a){const p={stallId:i,promoUser:a,promoAvatar:d,promoHTML:m,promoLinks:Ao(a,o.promoLinks),promoTags:Mo(o.promoTags)};s.promoData.push(p)}}),e.forEach(o=>{const i=new Set;o.promoData.forEach(s=>{s.promoTags.forEach(a=>i.add(a))}),o.promoTags=Array.from(i)}),Array.from(e.values())}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const ot=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","鼠","牛","虎","兔","龍","蛇","馬","羊","商","特","猴","雞","狗"],xo=(n,e)=>{const o=e.toLowerCase().trim();return o===""?n:n.filter(i=>{const s=i.promoData.some(a=>a.promoUser.toLowerCase().includes(o));return i.id.toLowerCase().includes(o)||i.stallTitle.toLowerCase().includes(o)||s})},It=(n,e,o)=>{const i=n.id.substring(0,1),s=n.num,a=["狗","雞","猴","特","商"].includes(i),d=ot.indexOf(i);if(o==="right"&&i>="A"&&i<="Q"&&(s===1||s===72))return null;if(o==="left"||o==="right"){const m=o==="right"?"prev":"next",p=!a&&!(s>=1&&s<=36),u=m==="next"?1:-1,T=p?-u:u;let f=s+T;for(;f>=1&&f<=72;){const r=e.find(l=>l.id.startsWith(i)&&l.num===f);if(r)return r.id;f+=T}return null}if(o==="up"||o==="down"){if(d===-1)return null;const m=o==="up"?1:-1;let p=d+m;for(;p>=0&&p<ot.length;){const u=ot[p],T=e.filter(f=>f.id.startsWith(u));if(T.length>0){let f;return a?o==="down"?f=T.sort((r,l)=>l.num-r.num)[0]:f=T.sort((r,l)=>r.num-l.num)[0]:(f=T.find(r=>r.num===s),f||(f=T.sort((r,l)=>Math.abs(r.num-s)-Math.abs(l.num-s))[0])),(f==null?void 0:f.id)||null}p+=m}}return null};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function Ro(n,e,o,i,s,a,d,m,p){const u=p?3.5:2.5,T=new Map,f=new Map;let r=!1,l=!1,b=!1,L=0,w=0,y=0,v=0,S=!1,I=null;const g=()=>{const R=n.offsetWidth,N=n.offsetHeight;if(R===0||N===0)return;const U=(o.offsetLeft+o.offsetWidth/2)/R*100,$=(o.offsetTop+o.offsetHeight/2)/N*100;if($<9.15||$>89.2){a.current.textContent="",a.prev.textContent="",a.next.textContent="";return}let B=null,mt=1/0;for(const O of ct){const ft=Math.max(O.border.left-U,0,U-O.border.right),k=Math.max(O.border.top-$,0,$-O.border.bottom),nt=ft*ft+k*k;nt<mt&&(mt=nt,B=O)}if(B){const O=ot.indexOf(B.id);a.current.textContent=B.id,a.prev.textContent=O>0?ot[O-1]:"",a.next.textContent=O<ot.length-1?ot[O+1]:""}else a.current.textContent="",a.prev.textContent="",a.next.textContent=""},M=()=>{const R=o.offsetWidth,N=o.offsetHeight,U=o.offsetLeft+R/2,$=o.offsetTop+N/2,z=-(U*u-R/2),J=-($*u-N/2);i.style.backgroundPosition=`${z}px ${J}px`,s.style.left=`${z}px`,s.style.top=`${J}px`,g()},C=(R,N)=>{const U=o.offsetWidth,$=o.offsetHeight,z=n.offsetWidth,J=n.offsetHeight,B=-U/2,mt=-$/2,O=z-U/2,ft=J-$/2,k=Math.max(B,Math.min(R,O)),nt=Math.max(mt,Math.min(N,ft));o.style.left=`${k}px`,o.style.top=`${nt}px`;const ut=a.current.parentElement;if(ut){const _t=ut.offsetWidth;let pt=0;k<0?pt=-k:k+_t>z&&(pt=z-(k+_t)),ut.style.transform=`translateX(${pt}px) translateY(-50%)`}M()},x=R=>{var z;R.preventDefault(),r=!0,S=!1,I=R.target;const N=(z=R.touches)==null?void 0:z[0],U=N?N.clientX:R.clientX,$=N?N.clientY:R.clientY;L=U,w=$,y=o.offsetLeft,v=o.offsetTop,document.addEventListener("mousemove",D),document.addEventListener("touchmove",D,{passive:!1}),document.addEventListener("mouseup",P),document.addEventListener("touchend",P)},D=R=>{var B;if(!r)return;const N=(B=R.touches)==null?void 0:B[0],U=N?N.clientX:R.clientX,$=N?N.clientY:R.clientY,z=U-L,J=$-w;!S&&(Math.abs(z)>5||Math.abs(J)>5)&&(S=!0),C(y+z,v+J)},P=()=>{r&&(r=!1,document.removeEventListener("mousemove",D),document.removeEventListener("touchmove",D),document.removeEventListener("mouseup",P),document.removeEventListener("touchend",P),!S&&I&&I.closest(".stall-area")&&m(I),I=null)},H=()=>{if(l=!0,i.style.backgroundSize=`${e.offsetWidth*u}px ${e.offsetHeight*u}px`,i.style.backgroundImage=`url('${e.src}')`,s.style.width=`${e.offsetWidth}px`,s.style.height=`${e.offsetHeight}px`,s.style.transform=`scale(${u})`,o.style.display="block",!b){const R=n.offsetWidth,N=n.offsetHeight,U=o.offsetWidth,$=o.offsetHeight;C((R-U)/2,(N-$)/2),b=!0}d.setAttribute("aria-pressed","true"),d.textContent="隱藏放大鏡",M()},Q=()=>{l=!1,o.style.display="none",d.setAttribute("aria-pressed","false"),d.textContent="顯示放大鏡"},K=()=>{l?Q():H()};return d.addEventListener("click",K),o.addEventListener("mousedown",x),o.addEventListener("touchstart",x,{passive:!1}),{addStall:R=>{const N=R.dataset.stallId;if(!N)return;const U=R.cloneNode(!0);s.appendChild(U),T.set(N,R),f.set(N,U)},addGroupArea:R=>{const N=R.cloneNode(!0);s.appendChild(N)},updateStallClass:(R,N,U)=>{const $=T.get(R);$&&$.classList.toggle(N,U);const z=f.get(R);z&&z.classList.toggle(N,U)},show:H,hide:Q,toggle:K,isShown:()=>l}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const No=["map-container","map-image","magnifier-wrapper","magnifier","magnifier-stall-layer","tooltip","modal","modal-close","modal-overlay","modal-title","modal-body","modal-footer","instructions-text","search-input","toggle-magnifier-btn","modal-magnifier-wrapper","modal-magnifier","modal-magnifier-stall-layer","modal-nav-controls","modal-nav-up","modal-nav-down","modal-nav-left","modal-nav-right","magnifier-row-indicator-container","magnifier-row-indicator-prev","magnifier-row-indicator-current","magnifier-row-indicator-next","modal-magnifier-row-indicator-container","modal-magnifier-row-indicator-prev","modal-magnifier-row-indicator-current","modal-magnifier-row-indicator-next","modal-vertical-stall-list","image-lightbox","image-lightbox-close","image-lightbox-image"];function Do(){const n={mapContainer:document.getElementById("map-container"),mapImage:document.getElementById("map-image"),magnifierWrapper:document.getElementById("magnifier-wrapper"),magnifier:document.getElementById("magnifier"),magnifierStallLayer:document.getElementById("magnifier-stall-layer"),magnifierRowIndicatorContainer:document.getElementById("magnifier-row-indicator-container"),magnifierRowIndicatorPrev:document.getElementById("magnifier-row-indicator-prev"),magnifierRowIndicatorCurrent:document.getElementById("magnifier-row-indicator-current"),magnifierRowIndicatorNext:document.getElementById("magnifier-row-indicator-next"),tooltip:document.getElementById("tooltip"),modal:document.getElementById("modal"),modalClose:document.getElementById("modal-close"),modalOverlay:document.getElementById("modal-overlay"),modalHeader:document.querySelector(".modal-header"),modalTitle:document.getElementById("modal-title"),modalBody:document.getElementById("modal-body"),modalFooter:document.getElementById("modal-footer"),instructionsEl:document.getElementById("instructions-text"),searchInput:document.getElementById("search-input"),toggleMagnifierBtn:document.getElementById("toggle-magnifier-btn"),modalMagnifierWrapper:document.getElementById("modal-magnifier-wrapper"),modalMagnifier:document.getElementById("modal-magnifier"),modalMagnifierStallLayer:document.getElementById("modal-magnifier-stall-layer"),modalMagnifierRowIndicatorContainer:document.getElementById("modal-magnifier-row-indicator-container"),modalMagnifierRowIndicatorPrev:document.getElementById("modal-magnifier-row-indicator-prev"),modalMagnifierRowIndicatorCurrent:document.getElementById("modal-magnifier-row-indicator-current"),modalMagnifierRowIndicatorNext:document.getElementById("modal-magnifier-row-indicator-next"),modalNavControls:document.getElementById("modal-nav-controls"),modalNavUp:document.getElementById("modal-nav-up"),modalNavDown:document.getElementById("modal-nav-down"),modalNavLeft:document.getElementById("modal-nav-left"),modalNavRight:document.getElementById("modal-nav-right"),modalVerticalStallList:document.getElementById("modal-vertical-stall-list"),imageLightbox:document.getElementById("image-lightbox"),imageLightboxClose:document.getElementById("image-lightbox-close"),imageLightboxImage:document.getElementById("image-lightbox-image")};for(const e in n)if(!n[e])throw new Error(`Essential DOM element not found: #${e}. The application cannot start.`);return n}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ot={selectedStallElement:null,stallIdToModalCloneMap:new Map,rowIdToModalGroupCloneMap:new Map};function Oo(n,e,o,i){const s=new Set(ct.filter(a=>a.isGrouped).map(a=>a.id));n.forEach(a=>{if(!a.coords)return;const d=document.createElement("div");d.className="stall-area",a.promoData.length>0&&d.classList.add("has-promo");const m=a.id.substring(0,1);s.has(m)&&d.classList.add("is-grouped-member"),d.dataset.stallId=a.id,d.style.top=a.coords.top,d.style.left=a.coords.left,d.style.width=a.coords.width,d.style.height=a.coords.height,d.setAttribute("aria-label",`Stall: ${a.stallTitle}`),a.num&&(d.textContent=a.num.toString().padStart(2,"0")),e.mapContainer.appendChild(d),o==null||o.addStall(d);const p=d.cloneNode(!0);e.modalMagnifierStallLayer.appendChild(p),i.stallIdToModalCloneMap.set(a.id,p)}),ct.forEach(a=>{const d=document.createElement("div");if(d.className="stall-area stall-group-area",d.dataset.rowId=a.id,d.style.top=`${a.border.top}%`,d.style.left=`${a.border.left}%`,d.style.width=`${a.border.right-a.border.left}%`,d.style.height=`${a.border.bottom-a.border.top}%`,d.setAttribute("aria-label",`Row: ${a.id}`),d.textContent=a.id,a.isGrouped||d.classList.add("mobile-only-group"),e.mapContainer.appendChild(d),a.isGrouped){o==null||o.addGroupArea(d);const m=d.cloneNode(!0);e.modalMagnifierStallLayer.appendChild(m),i.rowIdToModalGroupCloneMap.set(a.id,m)}})}function ce(n,e,o,i,s){const a=n.dataset.stallId;if(!a)return;i?i.updateStallClass(a,e,o):n.classList.toggle(e,o);const d=s.stallIdToModalCloneMap.get(a);d&&d.classList.toggle(e,o)}function Xe(n,e,o){o.selectedStallElement&&ce(o.selectedStallElement,"is-selected",!1,e,o),o.selectedStallElement=null,n.tooltip.classList.add("hidden")}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const A={wasMagnifierVisible:!1,isPanning:!1,panStartX:0,panStartY:0,initialBgX:0,initialBgY:0,panHappened:!1,clickTarget:null,animationFrameId:0,targetBgX:0,targetBgY:0};function ko(n,e,o){n&&(o.imageLightboxImage.src=n,o.imageLightboxImage.alt=e,o.imageLightbox.classList.remove("hidden"))}function Po(n){n.imageLightbox.classList.add("hidden"),n.imageLightboxImage.src=""}function Bo(n,e,o,i){const{elements:s,isMobile:a}=n,{modalMagnifier:d,mapImage:m,modalMagnifierRowIndicatorContainer:p}=s,{modalMagnifierRowIndicatorPrev:u,modalMagnifierRowIndicatorCurrent:T,modalMagnifierRowIndicatorNext:f}=s;p.style.display="flex";let r=null;if(i){const l=i.id.substring(0,1);r=ct.find(b=>b.id===l)??null}else{const l=a?4.5:1.8,b=d.offsetWidth,L=d.offsetHeight,w=m.offsetWidth,y=m.offsetHeight;if(w===0||y===0)return;const v=(b/2-e)/l,S=(L/2-o)/l,I=v/w*100,g=S/y*100;let M=1/0;for(const C of ct){const x=Math.max(C.border.left-I,0,I-C.border.right),D=Math.max(C.border.top-g,0,g-C.border.bottom),P=x*x+D*D;P<M&&(M=P,r=C)}}if(r&&r.id==="範")T.textContent="",u.textContent="",f.textContent="";else if(p.style.display="flex",r){const l=ot.indexOf(r.id);T.textContent=r.id,u.textContent=l>0?ot[l-1]:"",f.textContent=l<ot.length-1?ot[l+1]:""}else T.textContent="",u.textContent="",f.textContent=""}function Ve(n,e,o,i){const{elements:s,isMobile:a,allStalls:d,uiState:m}=n,{modalMagnifier:p,modalMagnifierStallLayer:u,mapImage:T}=s,f=a?4.5:1.8,r=p.offsetWidth,l=p.offsetHeight;if(r===0||l===0)return{clampedBgX:0,clampedBgY:0};const b=T.offsetWidth,L=T.offsetHeight;if(b===0||L===0)return{clampedBgX:0,clampedBgY:0};const w=b*f,y=L*f,v=Math.max(r-w,Math.min(e,0)),S=Math.max(l-y,Math.min(o,0));p.style.backgroundPosition=`${v}px ${S}px`,u.style.transform=`translate(${v}px, ${S}px) scale(${f})`;const I=r/f*.5,g=l/f*.5,M=-v/f-I,C=-S/f-g,x=(-v+r)/f+I,D=(-S+l)/f+g;return d.forEach(P=>{const H=m.stallIdToModalCloneMap.get(P.id);if(!H||!P.numericCoords)return;const{left:Q,top:K,width:dt,height:R}=P.numericCoords,N=Q/100*b,U=K/100*L,$=N+dt/100*b,z=U+R/100*L,J=N<x&&$>M&&U<D&&z>C;H.classList.toggle("modal-map-hidden",!J)}),ct.forEach(P=>{const H=m.rowIdToModalGroupCloneMap.get(P.id);if(!H)return;const Q=P.border.left/100*b,K=P.border.top/100*L,dt=P.border.right/100*b,R=P.border.bottom/100*L,N=Q<x&&dt>M&&K<D&&R>C;H.classList.toggle("modal-map-hidden",!N)}),Bo(n,v,S,i),{clampedBgX:v,clampedBgY:S}}function Ho(n,e){const{elements:o,isMobile:i}=e,{modalMagnifierWrapper:s,modalMagnifier:a,modalMagnifierStallLayer:d,mapImage:m}=o;if(!n||!n.coords){s.style.display="none";return}s.style.display="block",s.style.cursor="grab";const p=i?4.5:1.8,u=a.offsetWidth,T=a.offsetHeight;if(u===0||T===0){s.style.display="none";return}const f=m.offsetWidth,r=m.offsetHeight,l=f*p,b=r*p;d.style.width=`${f}px`,d.style.height=`${r}px`,a.style.backgroundSize=`${l}px ${b}px`,a.style.backgroundImage=`url('${m.src}')`;const{left:L,top:w,width:y,height:v}=n.numericCoords;if([L,w,y,v].some(x=>typeof x!="number")){console.error("Could not parse stall coordinates for modal magnifier:",n.coords),s.style.display="none";return}const S=(L+y/2)/100*f,I=(w+v/2)/100*r,g=u/2-S*p,M=T/2-I*p;Ve(e,g,M,n);let C=d.querySelector(".modal-stall-highlight");C||(C=document.createElement("div"),C.className="modal-stall-highlight",d.appendChild(C)),C.style.width=n.coords.width,C.style.height=n.coords.height,C.style.left=n.coords.left,C.style.top=n.coords.top,C.style.visibility="visible"}function vt(n,e){var v,S,I;const{allStalls:o,elements:i,magnifierController:s,uiState:a,isMobile:d}=e,m=o.find(g=>g.id===n);if(!m)return;s&&i.modal.classList.contains("hidden")&&(A.wasMagnifierVisible=s.isShown(),A.wasMagnifierVisible&&s.hide());const p=a.selectedStallElement,u=((v=p==null?void 0:p.dataset.stallId)==null?void 0:v.substring(0,1))??null;Xe(i,s,a);const T=document.querySelector(`.stall-area[data-stall-id="${n}"]`);T&&(a.selectedStallElement=T,ce(T,"is-selected",!0,s,a)),i.modalTitle.textContent=`${m.id}: ${m.stallTitle}`;let f=m.stallImg?`<img src="${m.stallImg}" alt="Official Promo Image: ${m.stallTitle}" class="official-stall-image" loading="lazy" onload="this.classList.add('loaded')"/>`:"";m.stallImg&&m.promoData.length>0&&(f+='<hr class="promo-section-separator">'),m.promoData.forEach((g,M)=>{M>0&&(f+='<div class="promo-entry-separator"></div>');const C=g.promoAvatar?g.promoAvatar:"https://images.plurk.com/3rbw6tg1lA5dEGpdKTL8j1.png";let x="";g.promoTags&&g.promoTags.length>0&&(x+='<div class="promo-tags-container">',g.promoTags.forEach(D=>{x+=`<span class="promo-tag">#${D}</span>`}),x+="</div>"),f+=`
      <div class="promo-entry">
          <div class="modal-user-info">
              <img src="${C}" alt="${g.promoUser}" class="modal-avatar">
              <span class="modal-username">${g.promoUser}</span>
          </div>
          ${x}
          <div class="promo-html-content">${g.promoHTML}</div>
      </div>`}),i.modalBody.innerHTML=f||"暫無宣傳資訊。",window.instgrm&&window.instgrm.Embeds.process(),window.twttr&&window.twttr.widgets.load(),i.modalFooter.innerHTML="";const r=g=>{if(g&&g.href){const M=document.createElement("a");M.href=g.href,M.textContent=g.text,M.className="footer-link",M.target="_blank",M.rel="noopener noreferrer",i.modalFooter.appendChild(M)}};m.promoData.forEach(g=>g.promoLinks.forEach(r)),m.stallLink&&r({href:m.stallLink,text:"社團網站"});const l=xo(o,i.searchInput.value),b=m.id.substring(0,1),w=["猴","雞","狗","特","商"].includes(b);if(w){i.modalNavLeft.style.display="none",i.modalNavRight.style.display="none",i.modalNavUp.style.display="block",i.modalNavDown.style.display="block",i.modalNavUp.ariaLabel="往上一個攤位",i.modalNavDown.ariaLabel="往下一個攤位";let g,M=1;for(;m.num+M<=34;){const D=(S=l.find(P=>P.id.startsWith(b)&&P.num===m.num+M))==null?void 0:S.id;if(D){g=D;break}M+=1}let C,x=-1;for(;m.num+x>0;){const D=(I=l.find(P=>P.id.startsWith(b)&&P.num===m.num+x))==null?void 0:I.id;if(D){C=D;break}x-=1}g||(g=It(m,l,"up")),C||(C=It(m,l,"down")),i.modalNavUp.disabled=!g,i.modalNavUp.dataset.targetId=g??"",i.modalNavDown.disabled=!C,i.modalNavDown.dataset.targetId=C??"",i.modalNavLeft.disabled=!0,i.modalNavRight.disabled=!0}else{i.modalNavLeft.style.display="block",i.modalNavRight.style.display="block",i.modalNavUp.style.display="block",i.modalNavDown.style.display="block",i.modalNavUp.ariaLabel="往上一排",i.modalNavDown.ariaLabel="往下一排";const g={up:It(m,l,"up"),down:It(m,l,"down"),left:It(m,l,"left"),right:It(m,l,"right")};i.modalNavUp.disabled=!g.up,i.modalNavUp.dataset.targetId=g.up??"",i.modalNavDown.disabled=!g.down,i.modalNavDown.dataset.targetId=g.down??"",i.modalNavLeft.disabled=!g.left,i.modalNavLeft.dataset.targetId=g.left??"",i.modalNavRight.disabled=!g.right,i.modalNavRight.dataset.targetId=g.right??""}const{modalVerticalStallList:y}=i;if(w){b!==u&&(y.scrollTop=0),y.innerHTML="",y.style.display="flex";const g=o.filter(x=>x.id.startsWith(b)).sort((x,D)=>D.num-x.num),M=i.searchInput.value.toLowerCase().trim();g.forEach(x=>{const D=document.createElement("div");D.className="modal-vertical-stall-item",D.dataset.stallId=x.id,D.textContent=x.num.toString().padStart(2,"0"),x.promoData.length>0&&D.classList.add("has-promo");let P=!1;if(M!==""){const H=x.promoData.some(K=>K.promoUser.toLowerCase().includes(M)),Q=x.promoTags.some(K=>K.toLowerCase().includes(M));P=x.id.toLowerCase().includes(M)||x.stallTitle.toLowerCase().includes(M)||H||Q}P&&D.classList.add("is-search-match"),x.id===n&&D.classList.add("is-selected"),y.appendChild(D)});const C=y.querySelector(".is-selected");C&&requestAnimationFrame(()=>{C.scrollIntoView({behavior:"smooth",block:"center"})})}else y.innerHTML="",y.style.display="none";document.body.classList.add("body-modal-open"),i.modal.classList.remove("hidden"),i.modalNavControls.style.display="grid",i.modal.setAttribute("aria-hidden","true"),Ho(m,e)}function se(n){const{elements:e,magnifierController:o,uiState:i}=n;document.body.classList.remove("body-modal-open"),e.modal.classList.add("hidden"),e.modalNavControls.style.display="none",e.modal.setAttribute("aria-hidden","true"),Xe(e,o,i),o&&A.wasMagnifierVisible&&o.show(),A.wasMagnifierVisible=!1,e.modalMagnifierWrapper.style.display="none",e.modalVerticalStallList.style.display="none"}function Uo(n,e){var m;const{allStalls:o,uiState:i}=e,s=n.closest(".stall-group-area"),a=n.closest(".stall-area:not(.stall-group-area)"),d=(m=i.selectedStallElement)==null?void 0:m.dataset.stallId;if(s!=null&&s.dataset.rowId){const p=s.dataset.rowId;if(p===(d==null?void 0:d.substring(0,1)))return;const u=o.filter(T=>T.id.startsWith(p)).sort((T,f)=>f.num-T.num);u.length>0&&vt(u[0].id,e)}else if(a!=null&&a.dataset.stallId){const p=a.dataset.stallId;if(p===d)return;vt(p,e)}}function Fo(n){const{elements:e}=n;e.modalNavControls.addEventListener("click",r=>{const l=r.target.closest(".modal-nav-btn");l!=null&&l.dataset.targetId&&vt(l.dataset.targetId,n)}),e.modalVerticalStallList.addEventListener("click",r=>{const l=r.target.closest(".modal-vertical-stall-item");l!=null&&l.dataset.stallId&&vt(l.dataset.stallId,n)});const{modalMagnifierWrapper:o,modalMagnifier:i,modalMagnifierStallLayer:s}=e,a=()=>{A.isPanning&&(Ve(n,A.targetBgX,A.targetBgY),A.animationFrameId=requestAnimationFrame(a))},d=r=>{var v;if(!A.isPanning)return;r.type==="touchmove"&&r.preventDefault();const l=(v=r.touches)==null?void 0:v[0],b=l?l.clientX:r.clientX,L=l?l.clientY:r.clientY,w=b-A.panStartX,y=L-A.panStartY;!A.panHappened&&(Math.abs(w)>5||Math.abs(y)>5)&&(A.panHappened=!0,o.style.cursor="grabbing"),A.panHappened&&(A.targetBgX=A.initialBgX+w,A.targetBgY=A.initialBgY+y)},m=()=>{cancelAnimationFrame(A.animationFrameId),document.removeEventListener("mousemove",d),document.removeEventListener("touchmove",d),document.removeEventListener("mouseup",m),document.removeEventListener("touchend",m),!A.panHappened&&A.clickTarget&&Uo(A.clickTarget,n),A.isPanning=!1,A.clickTarget=null,o.style.cursor="grab",i.style.transition="",s.style.transition=""},p=r=>{var g,M;const l=r.target;if(l.closest("#modal-vertical-stall-list"))return;const b=l.closest(".stall-group-area"),L=(g=n.uiState.selectedStallElement)==null?void 0:g.dataset.stallId;if(b&&L){const C=b.dataset.rowId,x=L.substring(0,1);if(C===x)return}if("button"in r&&r.button!==0)return;A.isPanning=!0,A.panHappened=!1,A.clickTarget=r.target;const w=(M=r.touches)==null?void 0:M[0],y=w?w.clientX:r.clientX,v=w?w.clientY:r.clientY;A.panStartX=y,A.panStartY=v;const S=new DOMMatrix(window.getComputedStyle(s).transform);A.initialBgX=S.e,A.initialBgY=S.f,A.targetBgX=A.initialBgX,A.targetBgY=A.initialBgY,i.style.transition="none",s.style.transition="none";const I=s.querySelector(".modal-stall-highlight");I&&(I.style.visibility="hidden"),cancelAnimationFrame(A.animationFrameId),A.animationFrameId=requestAnimationFrame(a),document.addEventListener("mousemove",d),document.addEventListener("touchmove",d,{passive:!1}),document.addEventListener("mouseup",m,{once:!0}),document.addEventListener("touchend",m,{once:!0})};o.addEventListener("mousedown",p),o.addEventListener("touchstart",p,{passive:!1});const u=()=>Po(e);e.modalBody.addEventListener("click",r=>{const l=r.target;if(l instanceof HTMLImageElement){let b="";const L=l.parentElement;l.classList.contains("official-stall-image")?b=l.src:l.closest(".promo-html-content")&&L instanceof HTMLAnchorElement?RegExp(/https?:\/\/.*\.(jpg|jpeg|png|gif|webp)(\?.*)?$/).test((L==null?void 0:L.href)??"")&&(b=l.alt,r.stopPropagation(),r.preventDefault()):b=l.src,ko(b,l.alt,e)}}),e.imageLightboxClose.addEventListener("click",u),e.imageLightbox.addEventListener("click",r=>{(r.target===e.imageLightbox||r.target===e.imageLightbox.querySelector(".lightbox-overlay"))&&u()}),e.modalClose.addEventListener("click",()=>se(n)),e.modalOverlay.addEventListener("click",()=>se(n)),document.addEventListener("keydown",r=>{if(!e.imageLightbox.classList.contains("hidden")){r.key==="Escape"&&u();return}if(!e.modal.classList.contains("hidden"))switch(r.key){case"Escape":se(n);break;case"ArrowUp":e.modalNavUp.click();break;case"ArrowDown":e.modalNavDown.click();break;case"ArrowLeft":e.modalNavLeft.click();break;case"ArrowRight":e.modalNavRight.click();break}});const{modalNavControls:T,tooltip:f}=e;T.addEventListener("mouseover",r=>{const l=r.target.closest(".modal-nav-btn");if(l instanceof HTMLButtonElement&&!l.disabled){const b=l.ariaLabel;if(b){f.innerHTML=b;const L=l.getBoundingClientRect();f.classList.remove("hidden");const w=f.getBoundingClientRect(),y=L.top-w.height-8,v=L.left+L.width/2-w.width/2;f.style.left=`${v}px`,f.style.top=`${y}px`}}else f.classList.add("hidden")}),T.addEventListener("mouseleave",()=>{f.classList.add("hidden")})}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function $o(n){const e=()=>No.every(i=>document.getElementById(i)),o=()=>{e()?n():requestAnimationFrame(o)};o()}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */function zo(n){ct.forEach(e=>{const o=document.createElement("div");o.className="debug-border",o.style.top=`${e.border.top}%`,o.style.left=`${e.border.left}%`,o.style.width=`${e.border.right-e.border.left}%`,o.style.height=`${e.border.bottom-e.border.top}%`;const i=document.createElement("span");i.textContent=e.id,o.appendChild(i),n.appendChild(o)})}async function Yo(){const n=Do();new URLSearchParams(window.location.search).get("debug")==="true"&&n.mapContainer.classList.add("debug-mode"),n.instructionsEl.textContent="正在載入地圖與攤位資料",n.instructionsEl.classList.add("loading-text");const o=new Promise((i,s)=>{n.mapImage.complete?i():(n.mapImage.onload=()=>i(),n.mapImage.onerror=()=>s(new Error("Map image failed to load.")))});try{const[i]=await Promise.all([oo(),o]);if(n.instructionsEl.classList.remove("loading-text"),i.length===0){n.mapContainer.innerHTML='<p style="color: red; padding: 20px;"><b>無法載入攤位資料：</b><br>請檢查您的 Google Sheet 是否已「發佈至網路」、網址是否正確，或檢查您的網路連線。</p>',n.instructionsEl.textContent="載入失敗";return}const s=Co(i),d=window.matchMedia("(max-width: 768px)").matches,m={allStalls:s,elements:n,magnifierController:null,uiState:Ot,isMobile:d},p=f=>{const r=f.closest(".stall-group-area"),l=f.closest(".stall-area:not(.stall-group-area)");if(r!=null&&r.dataset.rowId){const b=r.dataset.rowId,L=s.filter(w=>w.id.startsWith(b)).sort((w,y)=>y.num-w.num);L.length>0&&vt(L[0].id,m)}else l!=null&&l.dataset.stallId&&vt(l.dataset.stallId,m)},u=Ro(n.mapContainer,n.mapImage,n.magnifierWrapper,n.magnifier,n.magnifierStallLayer,{prev:n.magnifierRowIndicatorPrev,current:n.magnifierRowIndicatorCurrent,next:n.magnifierRowIndicatorNext},n.toggleMagnifierBtn,p,d);m.magnifierController=u,Oo(s,n,u,Ot),zo(n.mapContainer),Fo(m),n.searchInput.addEventListener("input",()=>{const f=n.searchInput.value.toLowerCase().trim(),r=new Set;s.forEach(l=>{const b=document.querySelector(`.stall-area[data-stall-id="${l.id}"]`);if(!b)return;let L=!1;if(f!==""){const w=l.promoData.some(v=>v.promoUser.toLowerCase().includes(f)),y=l.promoTags.some(v=>v.toLowerCase().includes(f));L=l.id.toLowerCase().includes(f)||l.stallTitle.toLowerCase().includes(f)||w||y}ce(b,"is-search-match",L,u,Ot),L&&r.add(l.id.substring(0,1))}),ct.forEach(l=>{document.querySelectorAll(`.stall-group-area[data-row-id="${l.id}"]`).forEach(L=>{const w=r.has(l.id);L.classList.toggle("is-search-match",w)})})});const T=f=>{const r=f.target;r.closest("#magnifier-wrapper")||(f.type==="touchstart"&&f.preventDefault(),p(r))};d?(n.instructionsEl.textContent="點擊按鈕可用放大鏡，或直接點擊攤位查看宣傳。",n.mapContainer.addEventListener("mousedown",T,{passive:!1}),n.mapContainer.addEventListener("touchstart",T,{passive:!1})):(n.instructionsEl.textContent="點擊按鈕顯示/隱藏放大鏡並拖曳。點擊攤位(含放大鏡內)可看宣傳。",document.addEventListener("mousemove",f=>{Ot.selectedStallElement||(n.tooltip.style.left=`${f.clientX+15}px`,n.tooltip.style.top=`${f.clientY+15}px`)}),n.mapContainer.addEventListener("mouseover",f=>{var b;const l=f.target.closest(".stall-area:not(.stall-group-area)");if(l&&!Ot.selectedStallElement){const L=l.dataset.stallId,w=s.find(y=>y.id===L);if(w){const y=(b=w.promoData)==null?void 0:b.map(v=>v.promoUser).filter((v,S,I)=>I.indexOf(v)===S).join(",");n.tooltip.innerHTML=`<strong>${w.stallTitle}</strong><br><small>${w.id}${y?` / ${y}`:""}</small>`,n.tooltip.classList.remove("hidden")}}}),n.mapContainer.addEventListener("mouseout",f=>{f.target.classList.contains("stall-area")&&n.tooltip.classList.add("hidden")}),n.mapContainer.addEventListener("mousedown",T))}catch(i){console.error("Failed to initialize app:",i),n.instructionsEl.classList.remove("loading-text"),n.instructionsEl.textContent="地圖或資料載入失敗，請重新整理頁面。"}}$o(Yo);
